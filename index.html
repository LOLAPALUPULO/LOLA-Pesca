<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LOLA Pesca - Tactical Ops</title>
    <script type="importmap">
{
  "imports": {
    "recharts": "https://aistudiocdn.com/recharts@^3.5.1",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.31.0",
    "react-dom": "https://aistudiocdn.com/react-dom@^1.31.0"
  }
}
</script>
    <style>
        /* --- FUENTE TACTICAL --- */
        @font-face {
            font-family: 'PitchedBattle';
            src: url('https://raw.githubusercontent.com/LOLAPALUPULO/LOLA-Pesca/main/Pitched%20Battle.ttf') format('truetype');
        }

        :root {
            /* Marine Blue Theme Defaults (Unified Theme) - Even Darker Version */
            --bg: #000a1a; /* Ultra dark blue, almost black for overall background */
            --bg-rgb: 0, 10, 26;
            --bg-gradient-top: #002244; /* Deep marine blue for top of gradient */
            --bg-gradient-bottom: #000a1a; /* Ultra dark blue for bottom of gradient */
            --card: #0a2d4b; /* Dark blue-grey for cards */
            --card-rgb: 10, 45, 75;
            --text: #ffffff; /* White text for dark background */
            --text-light: #a0a7b3; /* Light grey-blue text for secondary info */
            --blue: #88eeff; /* Even brighter blue for highlights */
            --green: #88ff88; /* Even brighter green for highlights */
            --yellow: #ffff88; /* Even brighter yellow for highlights */
            --orange: #ffb166; /* Even brighter orange for highlights */
            --danger: #ff6666; /* Even brighter red for highlights */
            --font-title: 'PitchedBattle', sans-serif;
            --font-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

            /* RGB versions for rgba() functions */
            --blue-rgb: 136, 238, 255;
            --green-rgb: 136, 255, 136;
            --yellow-rgb: 255, 255, 136;
            --orange-rgb: 255, 177, 102;
            --danger-rgb: 255, 102, 102;
            --text-rgb: 255, 255, 255; /* ffffff */
            --text-light-rgb: 160, 167, 179; /* a0a7b3 */


            /* WebGL-like effects (adjusted for deeper marine theme) */
            --shadow-dark: rgba(0, 0, 0, 0.9); /* Very pronounced dark shadow */
            --shadow-light: rgba(var(--blue-rgb), 0.4); /* More visible blue shadow */
            --shadow-inner: rgba(0, 0, 0, 0.5); /* Very pronounced inner shadow */
            --border-glow: rgba(var(--blue-rgb), 0.6);
            --gradient-card: linear-gradient(145deg, #0f3c64 0%, #0a2d4b 100%); /* Dark card gradient */
            --gradient-button: linear-gradient(145deg, #88eeff 0%, #44bbee 100%); /* Blue button */
            --button-shadow-color: #44bbee;
            --border-line-color: #4a86c4; /* Brighter blue-grey border color */
            --torch-bg-start: #3a4759; /* Darker torch background */
            --torch-bg-end: #2d3846;
            --torch-shadow: #2d3846;
            --log-delete-bg: #8c0a0a; /* Darker red for delete */
            --log-delete-bg-hover: #b30d0d;
            --log-delete-color: var(--danger);
            --log-button-shadow-color: #30b05b;

            /* Icon Glow */
            --icon-default-glow: 0 0 12px rgba(var(--blue-rgb), 1.0); /* Even Stronger blue glow */
        }

        body {
            font-family: var(--font-default);
            color: var(--text);
            margin: 0;
            padding: 12px;
            padding-bottom: 120px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;

            /* Main background gradient: Deep marine at top, blending to ultra dark marine at bottom */
            background-image:
                linear-gradient(to bottom, var(--bg-gradient-top) 0%, var(--bg-gradient-bottom) 100%),
                radial-gradient(circle at top left, rgba(var(--blue-rgb), 0.2) 0%, transparent 50%),
                radial-gradient(circle at bottom right, rgba(var(--bg-rgb), 0.1) 0%, transparent 70%);
            background-attachment: fixed; /* Keep background fixed when scrolling */
            background-size: cover;
            background-color: var(--bg); /* Fallback */
        }

        /* --- LOGO --- */
        .brand-header {
            text-align: center;
            padding: 10px 0;
            display: flex;
            justify-content: center;
        }
        .brand-link { width: 60%; display: block; }
        .brand-logo {
            width: 100%; 
            height: auto;
            filter: drop-shadow(0 0 15px var(--shadow-dark)) drop-shadow(0 0 8px var(--blue)); /* Enhanced glow */
        }

        /* --- CONTENEDORES --- */
        .card-box, .data-box {
            background: var(--gradient-card);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 5px 15px var(--shadow-dark),
                        inset 0 0 8px rgba(var(--blue-rgb), 0.08); /* Blue inner glow */
            text-align: center;
            position: relative;
            transition: all 0.2s ease-out;
            border: 1px solid rgba(var(--blue-rgb), 0.1);
        }

        .data-box {
            padding: 15px 5px;
            min-height: 110px;
        }
        .data-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--shadow-dark),
                        0 0 15px var(--shadow-light),
                        inset 0 0 10px rgba(var(--blue-rgb), 0.15);
        }

        /* --- TEXTOS --- */
        .lbl { 
            font-family: var(--font-title); 
            color: var(--text-light);
            font-size: 0.9rem; 
            margin-bottom: 5px; 
            letter-spacing: 1px; 
            text-transform: uppercase; 
            text-shadow: none; /* No shadow on labels */
        }
        
        .lbl-with-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .lbl-icon {
            font-size: 1.1em;
            line-height: 1;
            text-shadow: var(--icon-default-glow); /* Default glow for all general icons */
        }

        .val { 
            font-size: 2.4rem; 
            font-weight: 900; 
            margin-top: 2px; 
            line-height: 1; 
            color: var(--text);
            text-shadow: none; /* Removed glow from main values */
        }
        
        .sub-val { 
            font-size: 1rem; 
            color: var(--text-light); /* Adjusted for theme */
            margin-top: 6px; 
            font-weight: 600;
        }

        .section-header { 
            text-align: center; 
            color: var(--blue); 
            font-family: var(--font-title); 
            margin: 30px 0 15px 0; 
            font-size: 1.4rem; 
            letter-spacing: 1px; 
            border-bottom: 2px solid var(--border-line-color); 
            padding-bottom: 8px;
            text-shadow: none; /* Removed glow from section headers */
        }
        
        /* HEADER UBICACI√ìN */
        .location-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 6px solid var(--blue);
            text-align: left;
            padding: 15px;
            background: linear-gradient(90deg, rgba(var(--card-rgb), 0.8) 0%, var(--card) 100%);
            box-shadow: 0 3px 10px var(--shadow-dark);
        }
        
        .loc-title { 
            font-size: 1.4rem; 
            color: var(--text); 
            margin-bottom: 2px; 
            font-weight:bold; 
            font-family: var(--font-title); 
            text-shadow: none; /* Removed glow from location title */
        }
        .loc-sub { font-size: 0.8rem; color: var(--green); }

        .location-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .location-controls button {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text);
            padding: 0;
            line-height: 1;
            transition: transform 0.1s ease-out, color 0.1s ease-out;
            text-shadow: 0 0 10px rgba(var(--blue-rgb), 0.7); /* Stronger button icon glow */
        }
        .location-controls button:hover {
            transform: scale(1.1);
            color: var(--blue);
            text-shadow: 0 0 12px var(--blue); /* Stronger hover glow */
        }

        /* --- GRILLAS --- */
        .grid-main-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        
        .ambient-data-box {
            min-height: 65px;
            padding: 8px 4px;
        }
        .ambient-data-box .val {
            font-size: 1.8rem;
        }
        .ambient-data-box .lbl {
            font-size: 0.85rem;
            margin-bottom: 1px;
        }
        .ambient-data-box .sub-val {
            font-size: 0.7rem;
            margin-top: 2px;
        }

        .ambient-grid-parent {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        @media (min-width: 600px) {
            .ambient-grid-parent {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* --- BR√öJULA --- */
        .compass-container { cursor: pointer; } 
        .compass-label { 
            font-family: var(--font-title); 
            font-size: 0.9rem;
            color: var(--text); /* Matches HORA ACTUAL text color */
            margin-bottom: 8px;
            text-shadow: none; /* Removed glow from compass label */
        }
        .compass-rose {
            width: 120px; /* Increased size */
            height: 120px; /* Increased size */
            border-radius: 50%;
            background: linear-gradient(145deg, rgba(var(--card-rgb), 0.8) 0%, rgba(var(--card-rgb), 0.5) 100%);
            border: 3px solid #cfd8e3; /* Adjusted for light theme */
            position: relative; 
            box-shadow: inset 0 0 15px rgba(0,0,0,0.2), 0 0 8px rgba(var(--blue-rgb), 0.1); /* Adjusted for light theme */
        }
        
        .cardinal { 
            position: absolute; 
            font-size: 0.9rem; /* Adjusted font size */
            font-weight: bold; 
            color: var(--text-light); 
        }
        .c-n { top: 8px; left: 50%; transform: translateX(-50%); color: var(--danger); } /* Adjusted position */
        .c-e { right: 8px; top: 50%; transform: translateY(-50%); } /* Adjusted position */
        .c-s { bottom: 8px; left: 50%; transform: translateX(-50%); } /* Adjusted position */
        .c-o { left: 8px; top: 50%; transform: translateY(-50%); } /* Adjusted position */

        .compass-needle {
            position: absolute; top: 50%; left: 50%;
            width: 10px; /* Increased size */
            height: 100px; /* Increased size */
            background: linear-gradient(to bottom, var(--danger) 50%, var(--text) 50%);
            transform: translate(-50%, -50%) rotate(0deg);
            box-shadow: 0 0 8px rgba(0,0,0,0.3); /* Adjusted for light theme */
            z-index: 10;
        }
        
        /* --- RELOJ ANAL√ìGICO (NUEVOS ESTILOS) --- */
        .clock-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        .analog-clock {
            width: 120px; /* Increased size */
            height: 120px; /* Increased size */
            border-radius: 50%;
            background: linear-gradient(145deg, rgba(var(--card-rgb), 0.8) 0%, rgba(var(--card-rgb), 0.5) 100%);
            border: 3px solid #cfd8e3; /* Adjusted for light theme */
            position: relative;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.2), 0 0 8px rgba(var(--blue-rgb), 0.1); /* Adjusted for light theme */
        }
        
        .analog-clock::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px; /* Increased size */
            height: 10px; /* Increased size */
            background-color: var(--blue);
            border-radius: 50%;
            z-index: 5;
            border: 1px solid rgba(var(--text-rgb), 0.2); /* Adjusted for light theme */
            box-shadow: 0 0 8px var(--blue);
        }

        .clock-number {
            position: absolute;
            font-size: 0.7rem; /* Adjusted font size */
            font-weight: bold;
            color: var(--text);
            transform: translate(-50%, -50%);
            z-index: 1;
            text-shadow: 0 0 2px rgba(0,0,0,0.1); /* Subtle text shadow kept for legibility */
        }
        
        .clock-number:nth-child(1) { top: 5%; left: 50%; }
        .clock-number:nth-child(2) { top: 15%; left: 69%; }
        .clock-number:nth-child(3) { top: 25%; left: 85%; }
        .clock-number:nth-child(4) { top: 46%; left: 95%; }
        .clock-number:nth-child(5) { top: 69%; left: 85%; }
        .clock-number:nth-child(6) { top: 83%; left: 69%; }
        .clock-number:nth-child(7) { top: 90%; left: 49%; }
        .clock-number:nth-child(8) { top: 83%; left: 29%; }
        .clock-number:nth-child(9) { top: 69%; left: 13%; }
        .clock-number:nth-child(10) { top: 46%; left: 4%; }
        .clock-number:nth-child(11) { top: 25%; left: 13%; }
        .clock-number:nth-child(12) { top: 15%; left: 29%; }
        
        .hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom;
            transform: translateX(-50%) rotate(0deg);
            border-radius: 2px;
            z-index: 1;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .hour-hand {
            width: 5px; /* Increased size */
            height: 35px; /* Increased size */
            background-color: var(--text);
            z-index: 3;
        }

        .minute-hand {
            width: 4px; /* Increased size */
            height: 50px; /* Increased size */
            background-color: var(--blue);
            z-index: 2;
        }

        .second-hand-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80px; /* Increased size */
            height: auto;
            transform-origin: 50% 50%;
            transform: translate(-50%, -50%) rotate(0deg);
            z-index: 4;
            transition: transform 0.05s linear;
            filter: drop-shadow(0 0 8px var(--blue)); /* Stronger glow for logo hand */
        }
        /* --- FIN RELOJ ANAL√ìGICO --- */

        /* --- FASE LUNAR DENTRO DE DATA-BOX --- */
        .moon-phase-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px 5px;
            min-height: 110px;
        }
        .moon-phase-box #moon-icon {
            font-size: 3rem;
            margin: 0;
            line-height: 1;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(var(--text-rgb), 0.8); /* Stronger moon icon glow */
        }
        .moon-phase-box #moon-phase {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--text);
            text-transform: uppercase;
            text-shadow: none; /* Removed glow from moon phase text */
        }
        /* --- FIN FASE LUNAR DENTRO DE DATA-BOX --- */

        /* --- GUIA PECES --- */
        .guide-container { padding: 15px; }
        .tabs { 
            display: flex; 
            margin-bottom: 15px; 
            border-bottom: 2px solid var(--border-line-color); 
            box-shadow: inset 0 -2px 5px var(--shadow-dark);
        }
        .tab { 
            flex: 1; padding: 15px; text-align: center; background: none; border: none; 
            color: var(--text-light);
            font-size: 1.2rem; cursor: pointer; font-family: var(--font-title); 
            transition: all 0.2s ease;
            text-shadow: none; /* No shadow on tabs */
        }
        .tab.active { 
            color: var(--blue); 
            border-bottom: 3px solid var(--blue); 
            text-shadow: none; /* Removed glow from active tab text */
        }
        .tab:hover {
            color: var(--blue);
            text-shadow: none; /* Removed glow from hover tab text */
        }
        
        select { 
            width: 100%; padding: 15px; 
            background: var(--card); /* Adapted to theme variable */
            border: 1px solid var(--border-line-color); 
            color: var(--text); 
            border-radius: 8px; 
            font-size: 1.2rem;
            box-shadow: inset 0 1px 3px var(--shadow-inner);
        }

        .fish-details { 
            margin-top: 15px; display: none; padding: 15px; 
            background: var(--gradient-card);
            border-radius: 10px; 
            border: 1px solid rgba(var(--blue-rgb), 0.15);
            box-shadow: inset 0 0 5px var(--shadow-inner);
        }
        .fish-details.show { display: block; animation: fadeIn 0.3s; }
        .detail-item { margin-bottom: 15px; border-bottom: 1px solid var(--border-line-color); padding-bottom: 10px; }
        .detail-item:last-child { border: none; }

        /* --- TICKER ANIMATION (ESTRATEGIAS) --- */
        .ticker-wrap {
            width: 100%;
            overflow: hidden;
            background-color: var(--card);
            padding-top: 12px;
            padding-bottom: 12px;
            white-space: nowrap;
            box-sizing: border-box;
            border-top: 1px solid rgba(var(--blue-rgb), 0.1);
            border-bottom: 1px solid rgba(var(--blue-rgb), 0.1);
            margin-bottom: 12px;
            box-shadow: inset 0 1px 3px var(--shadow-inner), inset 0 -1px 3px var(--shadow-inner);
        }

        .ticker {
            display: inline-block;
            padding-left: 100%;
            animation: ticker-scroll 160s linear infinite;
            color: var(--yellow);
            font-family: var(--font-default); 
            font-size: 0.9rem; 
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: none; /* Removed glow from ticker text */
        }

        @keyframes ticker-scroll {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }

        /* --- PREDICCION ESPECIES --- */
        .prediction-box { 
            background: rgba(var(--blue-rgb), 0.1);
            border: 1px solid var(--border-line-color); 
            text-align: left; 
            padding: 15px; 
            display: none; 
            box-shadow: 0 0 10px rgba(var(--blue-rgb), 0.15);
        }
        .species-list { font-size: 1.1rem; color: var(--text); font-weight: 500; margin-top: 8px; line-height: 1.4; }
        .biome-tag { 
            font-size: 0.9rem; 
            background: var(--blue); 
            color: #000; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-weight: bold; 
            box-shadow: 0 2px 5px var(--shadow-dark);
        }

        /* --- BOTONES --- */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px;}
        .btn-action {
            padding: 22px; border: none; border-radius: 12px; 
            color: white;
            display: flex; align-items: center; justify-content: center; gap: 10px; 
            font-size: 1.2rem; cursor: pointer; font-family: var(--font-title);
            box-shadow: 0 6px 0 var(--button-shadow-color), 0 0 15px rgba(var(--blue-rgb), 0.3);
            transition: all 0.15s ease;
            background: var(--gradient-button);
            text-shadow: none; /* Removed glow from button text */
        }
        
        .btn-action:active { 
            transform: translateY(3px); 
            box-shadow: 0 3px 0 var(--button-shadow-color), 0 0 10px rgba(var(--blue-rgb), 0.2);
        }
        .btn-torch { 
            background: linear-gradient(145deg, var(--torch-bg-start) 0%, var(--torch-bg-end) 100%);
            box-shadow: 0 6px 0 var(--torch-shadow), 0 0 10px rgba(var(--text-light-rgb), 0.3);
            color: var(--text); /* Ensure text is readable in both themes */
            text-shadow: none; /* No text shadow unless active */
        }
        
        .btn-torch.on { 
            background: linear-gradient(145deg, #f1f5f9 0%, #e0e7ee 100%);
            color: #0b1120;
            box-shadow: 0 6px 0 #c2c9d0, 0 0 25px white;
            text-shadow: none; /* Removed glow from active torch button text */
        }
        
        .btn-log { 
            background: linear-gradient(145deg, var(--green) 0%, var(--log-button-shadow-color) 100%);
            box-shadow: 0 6px 0 var(--log-button-shadow-color), 0 0 15px rgba(var(--green-rgb), 0.3);
            color: #064e3b;
        }
        

        /* --- BIT√ÅCORA --- */
        .log-container { margin-top: 30px; border-top: 2px solid var(--border-line-color); padding-top: 15px; }
        .log-item {
            background: var(--gradient-card);
            border-left: 5px solid var(--green);
            padding: 12px; margin-bottom: 10px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 2px 5px var(--shadow-dark);
        }
        .log-text { font-size: 1rem; color: var(--text); font-weight: bold; }
        .log-date { font-size: 0.85rem; color: var(--text-light); display: block; margin-top: 4px; }
        .btn-delete { 
            background: var(--log-delete-bg);
            border-radius: 6px; 
            color: var(--log-delete-color); 
            font-size: 1.3rem; 
            width: 40px; height: 40px; border: none; 
            box-shadow: inset 0 1px 3px var(--shadow-inner);
            transition: background-color 0.15s ease;
            text-shadow: 0 0 8px rgba(var(--danger-rgb), 0.7); /* Glow for delete icon */
        }
        
        .btn-delete:hover {
            background-color: var(--log-delete-bg-hover);
        }
        

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Scrollbar styling for a high-tech look */
        ::-webkit-scrollbar {
            width: 8px;
            background-color: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--card);
            border-radius: 4px;
            border: 1px solid var(--blue);
            box-shadow: 0 0 5px var(--blue);
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: var(--blue);
            box-shadow: 0 0 8px var(--blue);
        }

    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>

    <!-- 1. LOGO CON ENLACE -->
    <div class="brand-header">
        <a href="https://www.instagram.com/lolapalupulo/" target="_blank" class="brand-link">
            <img src="https://raw.githubusercontent.com/LOLAPALUPULO/LOLA-Pesca/refs/heads/main/lolapesca.svg" alt="Lola Pesca" class="brand-logo">
        </a>
    </div>

    <!-- 2. UBICACI√ìN -->
    <div class="card-box location-bar">
        <div>
            <div class="loc-title" id="loc-name">üìç Buscando GPS...</div>
            <div class="loc-sub" id="gps-status">Estableciendo conexi√≥n...</div>
        </div>
        <div class="location-controls">
            <!-- Removed theme toggle button -->
            <button onclick="forceReload()" aria-label="Reload data">
                üîÑ
            </button>
        </div>
    </div>

    <!-- REORGANIZACI√ìN: Reloj / Br√∫jula / Temperatura -->
    <div class="grid-main-3">
        <!-- Reloj Anal√≥gico -->
        <div class="data-box" id="analog-clock-box">
            <span class="lbl">HORA ACTUAL</span>
            <div class="analog-clock" id="analog-clock">
                <span class="clock-number">12</span>
                <span class="clock-number">1</span>
                <span class="clock-number">2</span>
                <span class="clock-number">3</span>
                <span class="clock-number">4</span>
                <span class="clock-number">5</span>
                <span class="clock-number">6</span>
                <span class="clock-number">7</span>
                <span class="clock-number">8</span>
                <span class="clock-number">9</span>
                <span class="clock-number">10</span>
                <span class="clock-number">11</span>
                <div class="hand hour-hand" id="hour-hand"></div>
                <div class="hand minute-hand" id="minute-hand"></div>
                <img src="https://raw.githubusercontent.com/LOLAPALUPULO/LOLA-Pesca/refs/heads/main/lolapesca.svg" alt="LOLA Pesca" class="second-hand-logo" id="second-hand-logo">
            </div>
        </div>
        <!-- Br√∫jula (Movido) -->
        <div class="data-box compass-container" onclick="requestCompassPermission()">
            <div class="compass-label">BR√öJULA</div>
            <div class="compass-rose">
                <span class="cardinal c-n">N</span>
                <span class="cardinal c-e">E</span>
                <span class="cardinal c-s">S</span>
                <span class="cardinal c-o">O</span>
                <div class="compass-needle" id="compass-needle"></div>
            </div>
        </div>
        <!-- Temperatura (Movido) -->
        <div class="data-box">
            <span class="lbl lbl-with-icon"><span class="lbl-icon" id="temp-icon">üå°Ô∏è</span> TEMP</span>
            <span class="val" id="temp">--¬∞</span>
            <div class="sub-val" id="feels-like">ST: --¬∞</div>
        </div>
    </div>

    <!-- REORGANIZACI√ìN: Presi√≥n / Viento / Fase Lunar (Ex-Agua) -->
    <div class="grid-main-3">
        <!-- Presi√≥n HPA (Movido) -->
        <div class="data-box">
            <span class="lbl lbl-with-icon"><span class="lbl-icon">üìà</span> PRESI√ìN (hPa)</span>
            <span class="val" id="press">--</span>
            <span class="sub-val" id="press-desc" style="font-weight:bold">Esperando..</span>
        </div>
        <!-- Viento (Movido) -->
        <div class="data-box">
            <span class="lbl lbl-with-icon"><span class="lbl-icon">üå¨Ô∏è</span> VIENTO</span>
            <span class="val" id="wind-speed">--</span>
            <div class="sub-val" id="wind-dir" style="color: var(--blue); font-weight:bold;">--</div>
        </div>
        <!-- Fase Lunar (Movido al lugar de 'Agua') -->
        <div class="data-box moon-phase-box">
            <span class="lbl">FASE LUNAR</span>
            <span id="moon-icon">üåë</span>
            <div id="moon-phase">--</div>
        </div>
    </div>
    
    <!-- La antigua secci√≥n de Fase Lunar (card-box) ha sido eliminada. -->

    <!-- NUEVA SECCI√ìN: CONDICIONES AMBIENTALES -->
    <div class="section-header">CONDICIONES AMBIENTALES</div>

    <div class="ambient-grid-parent">
        <!-- Humedad -->
        <div class="data-box ambient-data-box">
            <span class="lbl lbl-with-icon"><span class="lbl-icon">üíß</span> HUMEDAD</span>
            <span class="val" id="humidity-val">--%</span>
            <span class="sub-val" style="font-weight:bold"></span>
        </div>
        <!-- Nubes -->
        <div class="data-box ambient-data-box">
            <span class="lbl lbl-with-icon"><span class="lbl-icon">‚òÅÔ∏è</span> NUBES</span>
            <span class="val" id="clouds-val">--%</span>
            <span class="sub-val" style="font-weight:bold"></span>
        </div>
        <!-- Amanecer -->
        <div class="data-box ambient-data-box">
            <span class="lbl lbl-with-icon"><span class="lbl-icon">‚òÄÔ∏è</span> AMANECER</span>
            <span class="val" id="sunrise-time">--:--</span>
            <span class="sub-val" style="font-weight:bold"></span>
        </div>
        <!-- Atardecer -->
        <div class="data-box ambient-data-box">
            <span class="lbl lbl-with-icon"><span class="lbl-icon">üåô</span> ATARDECER</span>
            <span class="val" id="sunset-time">--:--</span>
            <span class="sub-val" style="font-weight:bold"></span>
        </div>
    </div>

    <!-- NUEVA SECCI√ìN: GR√ÅFICO DE PRESI√ìN -->
    <div id="pressure-chart-container"></div>
    
    <!-- 6. CONSULTAS -->
    <div class="section-header">ENCICLOPEDIA T√ÅCTICA</div>

    <!-- TICKER (TEXTO PASANTE) DE ESTRATEGIAS -->
    <div class="ticker-wrap">
        <div class="ticker">
            ‚ö†Ô∏è SIGILO: Evita ruidos en la costa ‚Ä¢ üå¨Ô∏è VIENTO: Pesca donde golpea la ola, ah√≠ est√° la comida ‚Ä¢ üî™ AFILA: Revisa el filo del anzuelo siempre ‚Ä¢ ü¶Ö OBSERVA: Si hay gaviotas tir√°ndose, hay cardumen ‚Ä¢ üåë LUNAS: Nueva y Llena mueven m√°s agua ‚Ä¢ üìâ PRESI√ìN: Si baja de golpe, el pique se corta ‚Ä¢ ‚öôÔ∏è FRENO: Regula la estrella antes de tirar ‚Ä¢ ü™µ ESTRUCTURA: Busca palos y piedras, ah√≠ acecha el predador ‚Ä¢ü©∏ SANGRE: Cebo fresco es clave ‚Ä¢ üßµ NYLON: Revisa los √∫ltimos metros, si est√° rasposo cort√° ‚Ä¢ üêü DEVOLUCI√ìN: Cuid√° el recurso ‚Ä¢ üåä REPUNTE: El mejor momento es el cambio de marea ‚Ä¢ üßº LIMPIEZA: El pez huele el tabaco y combustible en tus manos.
        </div>
    </div>
    
    <div class="card-box prediction-box" id="bio-box">
        <span class="biome-tag" id="bio-region">ZONA...</span>
        <div class="lbl" style="margin-top:10px;">ESPECIES PREDOMINANTES:</div>
        <div class="species-list" id="bio-species">--</div>
    </div>

    <div class="card-box guide-container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('rio')">R√çO</button>
            <button class="tab" onclick="switchTab('mar')">MAR</button>
        </div>
        <select id="fish-selector" onchange="showFishInfo()">
            <!-- JS -->
        </select>
        <div id="fish-info" class="fish-details">
            <div class="detail-item">
                <div class="lbl">ANZUELO RECOMENDADO</div>
                <div id="fish-hook" style="font-size:1.2rem; color:var(--blue); font-weight:bold;">--</div>
            </div>
            <div class="detail-item">
                <div class="lbl">MEJOR CARNADA</div>
                <div id="fish-bait" style="font-size:1.2rem;">--</div>
            </div>
            <div class="detail-item">
                <div class="lbl">INTELIGENCIA T√ÅCTICA</div>
                <div id="fish-tip" style="font-size:1.1rem; color:var(--orange); font-style:italic; line-height: 1.4;">--</div>
            </div>
        </div>
    </div>

    <!-- 7. HERRAMIENTAS -->
    <div class="action-grid">
        <button id="btn-torch" class="btn-action btn-torch" onclick="toggleFlash()">
            üí° LINTERNA
        </button>
        <button class="btn-action btn-log" onclick="saveQuickLog()">
            üìù BIT√ÅCORA
        </button>
    </div>

    <div id="log-history" class="log-container">
        <div style="text-align:center; color:#666; font-size:1rem; padding:10px;">Sin historial</div>
    </div>
    
    <!-- Punto de montaje para la l√≥gica de React (oculto) -->
    <div id="react-root-dummy" style="display: none;"></div>

    <script>
        // --- CONFIG & DB AMPLIADA ---
        const fishDB = {
            rio: [
                {n:"Dorado", h:"5/0 a 8/0 Pata Larga", b:"Anguila, Morena, Sabalito", t:"Usa l√≠der de acero 40lbs MINIMO. Busca correderas y palos sumergidos. El dorado caza por vibraci√≥n y destello."},
                {n:"Surub√≠", h:"8/0 a 10/0 Ojal", b:"Morena grande, Anguila, Cascarudo", t:"Actividad nocturna. Busca veriles profundos y salidas de arroyos. Dejar comer antes de clavar."},
                {n:"Boga", h:"Simple chico (1 o 2) Pata Corta", b:"Ma√≠z fermentado, Masa, Salam√≠n, Coraz√≥n", t:"Boca muy dura pero pique sutil. Clava firme cuando corre la l√≠nea. Ceba la zona previamente."},
                {n:"Pejerrey (R√≠o)", h:"Peque√±o (4 o 5)", b:"Mojarra viva, Filet de dientudo", t:"Pesca a flote con boyas. Fundamental regular la profundidad (brazolada) seg√∫n la temperatura."},
                {n:"Tararira", h:"Offset para goma / Triple", b:"Rana de goma, Dientudo fresco", t:"Se activa con calor. Busca zonas bajas con vegetaci√≥n/juncos. Ataca por irritaci√≥n o hambre."},
                {n:"Bagre (Moncholo/Amarillo)", h:"3/0 Com√∫n", b:"Lombriz de tierra, Tripa de pollo", t:"Pez de fondo. Busca remansos donde el agua gira lento. Ideal para principiantes o pesca variada."},
                {n:"Pac√∫", h:"Corto y fuerte (Mustad 92611)", b:"Bolitas de masa, Fruta (Aguai), Coquitos", t:"Pica muy suave, como si robara la carnada. Pescar bajo √°rboles o camalotes."},
                {n:"Pat√≠", h:"8/0 a 10/0", b:"Anguila podrida, Tripa, Filet de S√°balo", t:"Prefiere aguas profundas y correntosas. Caza por olfato, usa carnada con olor fuerte."},
                {n:"Manguruy√∫", h:"12/0 Reforzado", b:"Anguila entera, boga viva chica", t:"El gigante del fondo. Equipo pesado exclusivo. Busca los pozos m√°s profundos del cauce."}
            ],
            mar: [
                {n:"Corvina Rubia", h:"3/0 a 5/0", b:"Langostino, Anchoa, Almeja", t:"Lanza a la 2da canaleta. Come succionando el fondo. Si hay cangrejo, ata la carnada con hilo el√°stico."},
                {n:"Corvina Negra", h:"6/0 a 8/0 Reforzado", b:"Cangrejo vivo (colorado/negro)", t:"Busca fondos de piedra o barro en r√≠as (San Clemente/Mar Chiquita). Paciencia extrema."},
                {n:"Lenguado", h:"Triple robador + Simple", b:"Pejerrey entero fresco", t:"Pesca din√°mica (spinning/trolling). Recogida muy lenta arrastrando por el fondo de arena."},
                {n:"Pescadilla", h:"2/0 a 3/0", b:"Camar√≥n, Filet de pejerrey", t:"Pica firme y voraz. Usa l√≠nea con destrabe o 'bait clip' para ganar distancia."},
                {n:"Pejerrey (Mar)", h:"Largo y fino (Cornalera)", b:"Camar√≥n, Filet magru, Mondongo", t:"L√≠nea de 3 boyas o paternoster. Busca la espuma de la ola (rompiente) o muelles."},
                {n:"Chucho / Raya", h:"6/0 a 8/0 Fuerte", b:"Anchoa entera, Calamar", t:"Se 'chupa' al fondo. No fuerces la ca√±a, manten√© tensi√≥n hasta que se mueva. Cuidado con la p√∫a."},
                {n:"Burriqueta", h:"N3 o N4 Fino", b:"Lombriz de mar, Camar√≥n", t:"Excelente pesca familiar. Se encuentra en la primer canaleta, muy cerca de la orilla."},
                {n:"Pez Elefante", h:"2/0 a 3/0", b:"Anchoa fresca, Lombriz de mar", t:"Pique sutil. Temporada invernal o primavera. Busca pozos de arena limpia."}
            ]
        };

        let currentMode = 'rio';
        let torchTrack = null;
        let dataRefreshInterval = null;
        let clockInterval = null;

        window.appPressureHistory = [];
        const MAX_PRESSURE_HISTORY_POINTS = 20;

        // --- STARTUP ---
        window.onload = () => {
            loadFishMenu();
            calculateMoonPhase();
            initApp(); 
            initCompass();
            renderLog();
            updateClock();
            clockInterval = setInterval(updateClock, 1000);
        };

        // --- CORE DATA LOGIC ---
        function forceReload() {
            document.getElementById('loc-name').innerHTML = "Reiniciando...";
            if (dataRefreshInterval) clearInterval(dataRefreshInterval);
            initApp();
        }

        function initApp() {
            const fallbackLat = -34.6037;
            const fallbackLon = -58.3816;

            if(!navigator.geolocation) {
                alert("Navegador sin soporte GPS. Usando ubicaci√≥n de respaldo.");
                fetchData(fallbackLat, fallbackLon, false);
                return;
            }

            const gpsOptions = { timeout: 8000, enableHighAccuracy: true };
            const safetyTimeout = setTimeout(() => {
                console.info("GPS tard√≥ mucho. Usando ubicaci√≥n de respaldo."); // Changed to info
                document.getElementById('gps-status').innerText = "Tiempo agotado. Modo Respaldo.";
                fetchData(fallbackLat, fallbackLon, false);
            }, 9000);

            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    clearTimeout(safetyTimeout);
                    fetchData(pos.coords.latitude, pos.coords.longitude, true);
                    if (dataRefreshInterval) clearInterval(dataRefreshInterval);
                    dataRefreshInterval = setInterval(() => fetchData(pos.coords.latitude, pos.coords.longitude, true), 300000);
                }, 
                (err) => {
                    clearTimeout(safetyTimeout);
                    let statusMessage = "GPS FALLO. Intentando modo DEMO.";
                    if (err.code === err.PERMISSION_DENIED) {
                        statusMessage = "GPS DENEGADO. Active en configuraci√≥n.";
                        console.info(`GPS Fall√≥: Permiso denegado por el usuario. Usando ubicaci√≥n de respaldo. Detalle: ${err.message}`); // Changed to info
                    } else {
                        console.info(`GPS Fall√≥: Error de adquisici√≥n (${err.message}). Usando ubicaci√≥n de respaldo.`); // Changed to info
                    }
                    document.getElementById('gps-status').innerText = `üî¥ ${statusMessage}`;
                    document.getElementById('gps-status').style.color = "var(--danger)";
                    document.getElementById('temp').innerText = "--¬∞";
                    document.getElementById('feels-like').innerText = "ST: --¬∞";
                    document.getElementById('wind-speed').innerText = "--";
                    document.getElementById('wind-dir').innerText = "--";
                    document.getElementById('press').innerText = "--";
                    document.getElementById('press-desc').innerText = "Sin Datos";
                    document.getElementById('humidity-val').innerText = '--%';
                    document.getElementById('clouds-val').innerText = '--%';
                    document.getElementById('sunrise-time').innerText = '--:--';
                    document.getElementById('sunset-time').innerText = '--:--';
                    fetchData(fallbackLat, fallbackLon, false);
                    if (dataRefreshInterval) clearInterval(dataRefreshInterval);
                    dataRefreshInterval = setInterval(() => fetchData(fallbackLat, fallbackLon, false), 300000);
                }, 
                gpsOptions
            );
        }

        function fetchData(lat, lon, isReal) {
            document.getElementById('gps-status').innerText = isReal ? "üü¢ GPS ACTIVO" : "üî¥ MODO DEMO (SIN GPS)";
            document.getElementById('gps-status').style.color = isReal ? "var(--green)" : "var(--danger)";

            if(isReal) {
                fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                .then(r=>r.json())
                .then(d => {
                    document.getElementById('loc-name').innerText = "üìç " + (d.address.city || d.address.town || d.address.village || "Zona Detectada");
                }).catch((e)=> {
                    console.error("Error al obtener nombre de ubicaci√≥n:", e);
                    document.getElementById('loc-name').innerText = "üìç Zona de Pesca (Nombre no disponible)";
                });
            } else {
                document.getElementById('loc-name').innerText = "üìç Buenos Aires (Defecto)";
            }

            determineSpecies(lat, lon);

            const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,pressure_msl,surface_pressure,wind_speed_10m,wind_direction_10m,relative_humidity_2m,cloud_cover&daily=sunrise,sunset&timezone=auto&windspeed_unit=kmh`;

            fetch(weatherUrl)
                .then(r => {
                    if (!r.ok) {
                        throw new Error(`HTTP error! status: ${r.status}`);
                    }
                    return r.json();
                })
                .then(data => {
                console.log("Open-Meteo API Response (Clima/Ambiente):", data);

                const cur = data.current || {};
                const daily = data.daily || {};

                // Temp
                const currentTemp = cur?.temperature_2m;
                const tempElement = document.getElementById('temp');
                const feelsLikeElement = document.getElementById('feels-like');
                const tempIconElement = document.getElementById('temp-icon');

                if (currentTemp !== undefined && currentTemp !== null) {
                    tempElement.innerText = `${Math.round(currentTemp)}¬∞`;
                    if (tempIconElement) {
                        if (currentTemp < 10) {
                            tempIconElement.style.color = "var(--blue)";
                            tempIconElement.style.textShadow = "0 0 10px var(--blue)"; /* Stronger glow */
                        } else if (currentTemp > 25) {
                            tempIconElement.style.color = "var(--danger)";
                            tempIconElement.style.textShadow = "0 0 10px var(--danger)"; /* Stronger glow */
                        } else {
                            tempIconElement.style.color = "var(--yellow)";
                            tempIconElement.style.textShadow = "0 0 10px var(--yellow)"; /* Stronger glow */
                        }
                    }
                } else {
                    tempElement.innerText = "--¬∞";
                    if (tempIconElement) {
                        tempIconElement.style.color = "var(--text-light)"; // Default neutral color, no strong glow if no data
                        tempIconElement.style.textShadow = "none";
                    }
                }
                
                feelsLikeElement.innerText = cur?.apparent_temperature !== undefined && cur?.apparent_temperature !== null ? `ST: ${Math.round(cur.apparent_temperature)}¬∞` : 'ST: --¬∞';

                // Viento
                document.getElementById('wind-speed').innerText = cur?.wind_speed_10m !== undefined && cur?.wind_speed_10m !== null ? `${Math.round(cur.wind_speed_10m)} km/h` : '--';
                let wDir = cur?.wind_direction_10m; 
                if (wDir !== undefined && wDir !== null) {
                    const dirs = ['NORTE', 'NE', 'ESTE', 'SE', 'SUR', 'SO', 'OESTE', 'NO'];
                    const dirIndex = Math.round(((wDir %= 360) < 0 ? wDir + 360 : wDir) / 45) % 8;
                    document.getElementById('wind-dir').innerText = "DEL " + dirs[dirIndex];
                } else {
                    document.getElementById('wind-dir').innerText = '--';
                }

                // Presi√≥n HPA
                const pressureHPA = cur?.pressure_msl;
                const pressElement = document.getElementById('press');
                const pDescElement = document.getElementById('press-desc');

                if (pressElement && pDescElement && pressureHPA !== undefined && pressureHPA !== null) {
                    pressElement.innerText = Math.round(pressureHPA).toString();
                    let descText; 
                    let descColor; 
                    if (pressureHPA <= 1009) {
                        descText = "BAJA";
                        descColor = "var(--danger)";
                    } else if (pressureHPA >= 1016) {
                        descText = "ALTA";
                        descColor = "var(--green)";
                    } else {
                        descText = "ESTABLE";
                        descColor = "var(--text-light)";
                    }
                    pDescElement.innerText = descText;
                    pDescElement.style.color = descColor;

                    window.appPressureHistory.push({
                        time: new Date().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' }),
                        hpa: Math.round(pressureHPA)
                    });
                    if (window.appPressureHistory.length > MAX_PRESSURE_HISTORY_POINTS) {
                        window.appPressureHistory.shift();
                    }
                    window.dispatchEvent(new CustomEvent('newPressureData'));

                } else {
                    if (pressElement) pressElement.innerText = "--";
                    if (pDescElement) pDescElement.innerText = "Sin Datos";
                }

                // Humedad
                const humidityVal = cur?.relative_humidity_2m;
                document.getElementById('humidity-val').innerText = (humidityVal !== undefined && humidityVal !== null) ? `${Math.round(humidityVal)}%` : '--%';
                if (humidityVal === undefined || humidityVal === null) console.warn("Humedad no disponible o es null en la respuesta de la API.");

                // Nubes
                const cloudsVal = cur?.cloud_cover;
                document.getElementById('clouds-val').innerText = (cloudsVal !== undefined && cloudsVal !== null) ? `${Math.round(cloudsVal)}%` : '--%';
                if (cloudsVal === undefined || cloudsVal === null) console.warn("Cobertura de nubes no disponible o es null en la respuesta de la API.");

                // Amanecer y Atardecer
                if (daily?.sunrise?.[0] && daily?.sunset?.[0]) {
                    const sunriseTime = new Date(daily.sunrise[0]).toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
                    const sunsetTime = new Date(daily.sunset[0]).toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
                    document.getElementById('sunrise-time').innerText = sunriseTime;
                    document.getElementById('sunset-time').innerText = sunsetTime;
                } else {
                    document.getElementById('sunrise-time').innerText = '--:--';
                    document.getElementById('sunset-time').innerText = '--:--';
                    console.warn("Datos de amanecer/atardecer no disponibles o est√°n vac√≠os en la respuesta de la API.");
                }

                console.log("UI actualizada para humedad, nubes, amanecer, atardecer.");

            }).catch(e => {
                console.error("API Error (Clima/Ambiente):", e);
                document.getElementById('temp').innerText = "--¬∞";
                document.getElementById('feels-like').innerText = "ST: --¬∞";
                document.getElementById('wind-speed').innerText = "--";
                document.getElementById('wind-dir').innerText = "--";
                document.getElementById('press').innerText = "--";
                document.getElementById('press-desc').innerText = "Sin Datos";
                document.getElementById('humidity-val').innerText = '--%';
                document.getElementById('clouds-val').innerText = '--%';
                document.getElementById('sunrise-time').innerText = '--:--';
                document.getElementById('sunset-time').innerText = '--:--';
                
                const tempIconElement = document.getElementById('temp-icon');
                if (tempIconElement) {
                    tempIconElement.style.color = "var(--text-light)";
                    tempIconElement.style.textShadow = "none";
                }
            });
        }

        // --- C√ÅLCULO LUNAR ---
        function calculateMoonPhase() {
            const date = new Date();
            const lp = 2551443; 
            const new_moon = new Date(1970, 0, 7, 20, 35, 0);
            const phase_total = ((date.getTime() - new_moon.getTime()) / 1000) % lp;
            const phase_days = Math.floor(phase_total / (24 * 3600)) + 1;
            
            let phase = "Nueva", icon = "üåë";
            if (phase_days >= 2 && phase_days < 8) { phase = "Creciente"; icon = "üåí"; }
            else if (phase_days >= 8 && phase_days < 10) { phase = "Cuarto Crec."; icon = "üåì"; }
            else if (phase_days >= 10 && phase_days < 14) { phase = "Gibosa"; icon = "üåî"; }
            else if (phase_days >= 14 && phase_days < 16) { phase = "LLENA"; icon = "üåï"; }
            else if (phase_days >= 16 && phase_days < 22) { phase = "Menguante"; icon = "üåñ"; }
            else if (phase_days >= 22 && phase_days < 24) { phase = "Cuarto Meng."; icon = "üåó"; }
            else if (phase_days >= 24) { phase = "Menguante"; icon = "üåò"; }
            
            const moonPhaseElement = document.getElementById('moon-phase');
            const moonIconElement = document.getElementById('moon-icon');

            if (moonPhaseElement && moonIconElement) {
                moonPhaseElement.innerText = phase.toUpperCase();
                moonIconElement.innerText = icon;
            } else {
                console.warn("Elementos de fase lunar no encontrados para actualizar. Aseg√∫rate de que los IDs 'moon-phase' y 'moon-icon' existan en el DOM.");
            }
        }

        function determineSpecies(lat, lon) {
            const box = document.getElementById('bio-box');
            const regionLbl = document.getElementById('bio-region');
            const speciesLbl = document.getElementById('bio-species');
            box.style.display = 'block';
            
            if (lat > -35 && lat < -33 && lon > -60 && lon < -57) {
                regionLbl.innerText = "DELTA / R√çO DE LA PLATA";
                speciesLbl.innerText = "Dorado, Boga, Tararira, Bagre, Surub√≠.";
            } else if (lat <= -36 && lat > -42 && lon > -60) {
                regionLbl.innerText = "COSTA ATL√ÅNTICA";
                speciesLbl.innerText = "Corvina, Pescadilla, Lenguado, Pejerrey.";
            } else if (lat > -33 && lat < -25 && lon > -60) {
                regionLbl.innerText = "LITORAL / PARAN√Å";
                speciesLbl.innerText = "Dorado, Surub√≠, Pac√∫, Manguruy√∫.";
            } else {
                regionLbl.innerText = "ZONA GENERAL";
                speciesLbl.innerText = "Variada local. Verifique reglamentaci√≥n.";
            }
        }

        // --- COMPASS ---
        function requestCompassPermission() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                .then(r => { if (r==='granted') initCompass(); else alert("Permiso denegado"); })
                .catch(console.error);
            } else {
                alert("Br√∫jula activa. Si no gira, gire el celular.");
            }
        }
        function initCompass() {
            if (window.DeviceOrientationEvent) {
                window.addEventListener("deviceorientation", function(e) {
                    let h = e.alpha; 
                    if(h !== null) { document.getElementById('compass-needle').style.transform = `translate(-50%, -50%) rotate(${360 - h}deg)`; }
                }, true);
            }
        }

        // --- RELOJ ANAL√ìGICO ---
        function updateClock() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();

            const secondHandLogo = document.getElementById('second-hand-logo');
            const minuteHand = document.getElementById('minute-hand');
            const hourHand = document.getElementById('hour-hand');

            if (secondHandLogo && minuteHand && hourHand) {
                const secondsDegrees = (seconds / 60) * 360;
                const minutesDegrees = ((minutes + seconds / 60) / 60) * 360;
                const hoursDegrees = ((hours % 12 + minutes / 60) / 12) * 360;

                secondHandLogo.style.transform = `translate(-50%, -50%) rotate(${secondsDegrees}deg)`;
                minuteHand.style.transform = `translateX(-50%) rotate(${minutesDegrees}deg)`;
                hourHand.style.transform = `translateX(-50%) rotate(${hoursDegrees}deg)`;
            }
        }

        // --- UI ---
        function switchTab(m){ currentMode=m; document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); event.target.classList.add('active'); loadFishMenu(); }
        function loadFishMenu(){ const s=document.getElementById('fish-selector'); s.innerHTML='<option>Selecciona pez...</option>'; fishDB[currentMode].forEach((f,i)=>{const o=document.createElement('option'); o.value=i; o.innerText=f.n; s.appendChild(o)}); document.getElementById('fish-info').classList.remove('show'); }
        function showFishInfo(){ const i=document.getElementById('fish-selector').value; if(!i)return; const f=fishDB[currentMode][i]; document.getElementById('fish-hook').innerText=f.h; document.getElementById('fish-bait').innerText=f.b; document.getElementById('fish-tip').innerText=f.t; document.getElementById('fish-info').classList.add('show'); }
        
        async function toggleFlash(){ 
            const b=document.getElementById('btn-torch'); 
            if(torchTrack){torchTrack.stop(); torchTrack=null; b.classList.remove('on'); return;} 
            try{ 
                const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}); 
                torchTrack=s.getVideoTracks()[0]; 
                await torchTrack.applyConstraints({advanced:[{torch:true}]}); 
                b.classList.add('on'); 
            }catch(e){alert("Error: Flash requiere permiso de c√°mara/HTTPS.");} 
        }

        // --- LOCALSTORAGE ---
        function saveQuickLog() {
            const text = prompt("üìù Captura (Especie - Kg):");
            if(text) {
                const now = new Date();
                const dStr = now.getDate() + "/" + (now.getMonth()+1) + " " + now.getHours() + ":" + (now.getMinutes()<10?'0':'')+now.getMinutes();
                const item = { id: Date.now(), text: text, date: dStr };
                let h = JSON.parse(localStorage.getItem('pescaLog')) || [];
                h.unshift(item);
                localStorage.setItem('pescaLog', JSON.stringify(h));
                renderLog();
            }
        }
        function renderLog() {
            const c = document.getElementById('log-history');
            const h = JSON.parse(localStorage.getItem('pescaLog')) || [];
            if (h.length === 0) { c.innerHTML = '<div style="text-align:center; color:#666; font-size:1rem; padding:10px;">Sin historial</div>'; return; }
            let html = "";
            h.forEach(i => {
                html += `<div class="log-item"><div><span class="log-text">${i.text}</span><span class="log-date">${i.date}</span></div><button class="btn-delete" onclick="deleteLog(${i.id})">√ó</button></div>`;
            });
            c.innerHTML = html;
        }
        function deleteLog(id) {
            if(confirm("¬øBorrar?")) {
                let h = JSON.parse(localStorage.getItem('pescaLog')) || [];
                h = h.filter(i => i.id !== id);
                localStorage.setItem('pescaLog', JSON.stringify(h));
                renderLog();
            }
        }
    </script>
    <script type="module" src="/index.tsx"></script>
</body>
</html>