<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LOLA Pesca - Tactical Ops</title>
    <script type="importmap">
{
  "imports": {
    "recharts": "https://aistudiocdn.com/recharts@^2.12.7",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^1.31.0",
    "react-dom": "https://aistudiocdn.com/react-dom@^19.2.1"
  }
}
</script>
    <style>
        /* --- FUENTE TACTICAL --- */
        @font-face {
            font-family: 'PitchedBattle';
            src: url('https://raw.githubusercontent.com/LOLAPALUPULO/LOLA-Pesca/main/Pitched%20Battle.ttf') format('truetype');
        }

        :root {
            /* Tactical Camouflage Theme */
            --bg: #0a1414; /* Base dark color for camouflage */
            --bg-rgb: 10, 20, 20;

            /* Camouflage Colors */
            --cam-color-1: #0f1a1a; /* Very dark, almost black, slightly greenish */
            --cam-color-1-rgb: 15, 26, 26;
            --cam-color-2: #1a2a2a; /* Dark grey-green */
            --cam-color-2-rgb: 26, 42, 42;
            --cam-color-3: #2a3a3a; /* Medium grey-green */
            --cam-color-3-rgb: 42, 58, 58;
            --cam-color-4: #3a4a4a; /* Lighter grey-green for variation */
            --cam-color-4-rgb: 58, 74, 74;

            /* Card Colors (Grey to Black Gradient) - EVEN DARKER */
            --card: #0d0d0d; /* Very dark grey for cards */
            --card-rgb: 13, 13, 13;
            --gradient-card: linear-gradient(145deg, #222222 0%, #0d0d0d 100%); /* Medium grey to very dark grey/black */

            --text: #ffffff; /* White text for dark background */
            --text-light: #e0e2e5; /* Off-white for secondary info (brighter for new dark cards) */
            --blue: #aaffff; /* Very vibrant light blue for highlights */
            --green: #aaffaa; /* Very vibrant green for highlights */
            --yellow: #ffffaa; /* Very vibrant yellow for highlights */
            --orange: #ffc288; /* Very vibrant orange for highlights */
            --danger: #ff3333; /* VERY vibrant red for highlights (changed from #ff8888) */
            --font-title: 'PitchedBattle', sans-serif;
            --font-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

            /* RGB versions for rgba() functions */
            --blue-rgb: 170, 255, 255;
            --green-rgb: 170, 255, 170;
            --yellow-rgb: 255, 255, 170;
            --orange-rgb: 255, 194, 136;
            --danger-rgb: 255, 51, 51; /* Updated RGB for new danger color */
            --text-rgb: 255, 255, 255; /* ffffff */
            --text-light-rgb: 224, 226, 229; /* e0e2e5 */


            /* WebGL-like effects (adjusted for deep tactical theme) */
            --shadow-dark: rgba(0, 0, 0, 0.95); /* Extremely pronounced dark shadow */
            --shadow-light: rgba(var(--blue-rgb), 0.5); /* More visible blue shadow */
            --shadow-inner: rgba(0, 0, 0, 0.7); /* Very pronounced inner shadow */
            --border-glow: rgba(var(--blue-rgb), 0.7);
            --gradient-button: linear-gradient(145deg, #aaffff 0%, #66cccc 100%); /* Blue button */
            --button-shadow-color: #66cccc;
            --border-line-color: #6688aa; /* Softer blue-grey border color */
            --torch-bg-start: #3a4759; /* Darker torch background */
            --torch-bg-end: #2d3846;
            --torch-shadow: #2d3846;
            --log-delete-bg: #8c0a0a; /* Darker red for delete */
            --log-delete-bg-hover: #b30d0d;
            --log-delete-color: var(--danger);
            --log-button-shadow-color: #30b05b;

            /* Icon Glow */
            --icon-default-glow: 0 0 12px rgba(var(--blue-rgb), 1.0); /* Even Stronger blue glow */
        }

        body {
            font-family: var(--font-default);
            color: var(--text);
            margin: 0;
            padding: 12px;
            padding-bottom: 120px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;

            /* Tactical Camouflage Background */
            background-color: var(--bg); /* Base for darkest part of camouflage */
            background-image:
                /* Camouflage layers (radial gradients for irregular shapes) */
                radial-gradient(circle at 10% 90%, rgba(var(--cam-color-1-rgb), 0.8) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 20%, rgba(var(--cam-color-1-rgb), 0.8) 0%, transparent 60%),
                radial-gradient(circle at 40% 10%, rgba(var(--cam-color-2-rgb), 0.7) 0%, transparent 70%),
                radial-gradient(ellipse at 90% 60%, rgba(var(--cam-color-2-rgb), 0.7) 0%, transparent 70%),
                radial-gradient(circle at 60% 40%, rgba(var(--cam-color-3-rgb), 0.6) 0%, transparent 80%),
                radial-gradient(ellipse at 20% 70%, rgba(var(--cam-color-3-rgb), 0.6) 0%, transparent 80%),
                radial-gradient(circle at 70% 80%, rgba(var(--cam-color-4-rgb), 0.4) 0%, transparent 90%),
                /* Subtle background light effects (integrating with camo) */
                radial-gradient(circle at top left, rgba(var(--blue-rgb), 0.1) 0%, transparent 50%),
                radial-gradient(circle at bottom right, rgba(var(--bg-rgb), 0.05) 0%, transparent 70%);

            background-size: 500px 500px, 600px 600px, 450px 450px, 550px 550px, 700px 700px, 400px 400px, 650px 650px, cover, cover; /* Varying sizes + fill */
            background-position: 0 0, 100px 150px, 250px 50px, 50px 300px, 300px 100px, 150px 400px, 400px 200px, 0 0, 0 0; /* Varying positions + fill */
            background-repeat: repeat; /* Repeat the camouflage pattern */
            background-attachment: fixed; /* Keep background fixed when scrolling */
        }

        body.no-scroll {
            overflow: hidden;
        }

        /* --- LOGO --- */
        .brand-header {
            text-align: center;
            padding: 10px 0;
            display: flex;
            justify-content: center;
        }
        .brand-link { width: 60%; display: block; }
        .brand-logo {
            width: 100%; 
            height: auto;
            filter: drop-shadow(0 0 15px var(--shadow-dark)) drop-shadow(0 0 8px var(--blue)); /* Enhanced glow */
        }

        /* --- CONTENEDORES --- */
        .card-box, .data-box {
            background: var(--gradient-card);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 5px 15px var(--shadow-dark),
                        inset 0 0 8px rgba(var(--blue-rgb), 0.08); /* Blue inner glow */
            text-align: center;
            position: relative;
            transition: all 0.2s ease-out, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Smooth transition for expansion */
            border: 1px solid rgba(var(--blue-rgb), 0.1);
            cursor: pointer; /* Indicate clickability */
        }

        .data-box {
            padding: 15px 5px;
            min-height: 110px;
        }
        .data-box:hover:not(.expanded) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--shadow-dark),
                        0 0 15px var(--shadow-light),
                        inset 0 0 10px rgba(var(--blue-rgb), 0.15);
        }

        /* Expanded card styles */
        .data-box.expanded {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 70vw; /* 70% of viewport width */
            max-width: 600px; /* Limit max width on very large screens */
            height: 70vh; /* 70% of viewport height */
            max-height: 600px; /* Limit max height */
            overflow-y: auto; /* Enable scrolling if content overflows */
            transform: translate(-50%, -50%) scale(1.05); /* Slight pop out effect */
            z-index: 1001; /* Above the overlay */
            animation: expandPop 0.3s forwards ease-out;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8), 0 0 30px var(--blue); /* More pronounced shadow */
            -webkit-mask-image: -webkit-radial-gradient(white, black); /* Fix for border-radius on Safari with backdrop-filter */
            mask-image: radial-gradient(white, black);
            cursor: default; /* No hover effect when expanded */
            padding: 25px; /* More padding when expanded */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        /* Hide main content when expanded, show detail */
        .data-box:not(.expanded) .main-content { display: block; }
        .data-box.expanded .main-content { display: none; }
        .data-box:not(.expanded) .expanded-detail { display: none; }
        .data-box.expanded .expanded-detail { display: flex; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; width: 100%;}


        /* Overlay for expanded card */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px); /* Subtle blur effect */
            -webkit-backdrop-filter: blur(5px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            cursor: pointer;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* --- TEXTOS --- */
        .lbl { 
            font-family: var(--font-title); 
            color: var(--text-light);
            font-size: 0.9rem; 
            margin-bottom: 5px; 
            letter-spacing: 1px; 
            text-transform: uppercase; 
            text-shadow: none; /* No shadow on labels */
        }
        
        .lbl-with-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        /* Base SVG icon styling */
        .svg-icon {
            width: 1.1em; /* Adjusted for better visual balance */
            height: 1.1em;
            vertical-align: middle;
            fill: currentColor; /* Inherit color from parent for thematic consistency */
            transition: transform 0.2s ease-out, filter 0.2s ease-out;
            filter: drop-shadow(0 0 5px rgba(var(--text-rgb), 0.3)); /* Subtle white/text-color glow by default */
            animation: iconPulse 3s infinite ease-in-out alternate;
        }

        /* Specific overrides for lbl-icon elements that had custom colors/glows */
        .lbl-icon .svg-icon {
            filter: drop-shadow(0 0 8px currentColor); /* Stronger glow for labeled icons, color inherited dynamically */
        }

        /* Expanded Icon Styling */
        .data-box.expanded .svg-icon {
            width: 3em; /* Larger icon when expanded */
            height: 3em;
            filter: drop-shadow(0 0 20px currentColor); /* More intense glow */
            animation: iconPulse 2s infinite ease-in-out alternate; /* Potentially faster pulse */
        }

        /* Moon icon specific animation for expanded state */
        .data-box.expanded .moon-phase-box #moon-icon {
            animation: moonGlow 3s infinite ease-in-out alternate; /* Adjust duration for expanded */
        }


        .val { 
            font-size: 2.4rem; 
            font-weight: 700; /* Adjusted for less thickness */
            margin-top: 2px; 
            line-height: 1; 
            color: var(--text);
            text-shadow: none; /* Removed glow from main values */
        }
        
        .sub-val { 
            font-size: 1rem; 
            color: var(--text-light); /* Adjusted for theme */
            margin-top: 6px; 
            font-weight: 500; /* Adjusted for less thickness */
        }

        .section-header { 
            text-align: center; 
            color: var(--blue); 
            font-family: var(--font-title); 
            margin: 30px 0 15px 0; 
            font-size: 1.4rem; 
            letter-spacing: 1px; 
            border-bottom: 2px solid var(--border-line-color); 
            padding-bottom: 8px;
            text-shadow: none; /* Removed glow from section headers */
        }
        
        /* HEADER UBICACIÓN */
        .location-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 6px solid var(--blue);
            text-align: left;
            padding: 15px;
            background: linear-gradient(90deg, rgba(var(--card-rgb), 0.8) 0%, var(--card) 100%);
            box-shadow: 0 3px 10px var(--shadow-dark);
            cursor: default; /* Not interactive for expansion */
        }
        
        .loc-title { 
            font-size: 1.4rem; 
            color: var(--text); 
            margin-bottom: 2px; 
            font-weight:600; /* Adjusted for less thickness */
            font-family: var(--font-title); 
            text-shadow: none; /* Removed glow from location title */
        }
        .loc-sub { font-size: 0.8rem; color: var(--green); }

        .location-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .location-controls button {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text);
            padding: 0;
            line-height: 1;
            transition: transform 0.1s ease-out, color 0.1s ease-out;
            text-shadow: 0 0 10px rgba(var(--blue-rgb), 0.7); /* Stronger button icon glow */
        }
        .location-controls button:hover {
            transform: scale(1.1);
            color: var(--blue);
            text-shadow: 0 0 12px var(--blue); /* Stronger hover glow */
        }

        /* Reload button icon */
        .location-controls button .svg-icon {
            width: 1.8em; /* Larger for reload button */
            height: 1.8em;
            animation: none; /* No pulse for interactive buttons */
            filter: drop-shadow(0 0 10px rgba(var(--blue-rgb), 0.7)); /* Initial glow matching button text shadow */
        }

        .location-controls button:hover .svg-icon {
            transform: scale(1.1) rotate(15deg); /* More pronounced hover for reload */
            filter: drop-shadow(0 0 15px var(--blue));
        }

        /* --- GRILLAS --- */
        .grid-main-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        
        .ambient-data-box {
            min-height: 65px;
            padding: 8px 4px;
        }
        .ambient-data-box .val {
            font-size: 1.8rem;
        }
        .ambient-data-box .lbl {
            font-size: 0.85rem;
            margin-bottom: 1px;
        }
        .ambient-data-box .sub-val {
            font-size: 0.7rem;
            margin-top: 2px;
        }

        .ambient-grid-parent {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        @media (min-width: 600px) {
            .ambient-grid-parent {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* --- BRÚJULA (ESTILOS ANTIGUOS - AHORA NO SE USA) --- */
        .compass-container { cursor: pointer; display: none; } /* Ocultar completamente */
        .compass-label { 
            font-family: var(--font-title); 
            font-size: 0.9rem;
            color: var(--text); /* Matches HORA ACTUAL text color */
            margin-bottom: 8px;
            text-shadow: none; /* Removed glow from compass label */
        }
        .compass-rose {
            width: 120px; /* Increased size */
            height: 120px; /* Increased size */
            border-radius: 50%;
            background: linear-gradient(145deg, rgba(var(--card-rgb), 0.8) 0%, rgba(var(--card-rgb), 0.5) 100%);
            border: 3px solid #cfd8e3; /* Adjusted for light theme */
            position: relative; 
            box-shadow: inset 0 0 15px rgba(0,0,0,0.2), 0 0 8px rgba(var(--blue-rgb), 0.1); /* Adjusted for light theme */
        }
        
        .cardinal { 
            position: absolute; 
            font-size: 0.9rem; /* Adjusted font size */
            font-weight: bold; 
            color: var(--text-light); 
        }
        .c-n { top: 8px; left: 50%; transform: translateX(-50%); color: var(--danger); } /* Adjusted position */
        .c-e { right: 8px; top: 50%; transform: translateY(-50%); } /* Adjusted position */
        .c-s { bottom: 8px; left: 50%; transform: translateX(-50%); } /* Adjusted position */
        .c-o { left: 8px; top: 50%; transform: translateY(-50%); } /* Adjusted position */

        .compass-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 50% 50%; /* Rotate around its center */
            width: 6px; /* Width of the shaft */
            height: 80px; /* Length of the shaft */
            background: linear-gradient(to bottom, var(--danger) 60%, var(--text) 60%); /* Red on top 60%, white on bottom 40% (adjusted) */
            border-radius: 2px; /* Slight rounding for the shaft */
            box-shadow: 0 0 5px rgba(0,0,0,0.5); /* Subtle shadow */
            z-index: 10;
            transform: translate(-50%, -50%) rotate(0deg); /* Initial centering, JS updates rotation */
            transition: transform 0.1s linear; /* Smooth rotation */
        }

        .compass-needle::before { /* North tip (red) */
            content: '';
            position: absolute;
            bottom: 100%; /* Position right above the shaft */
            left: -7px; /* Adjust to center the triangle based on its width (10px triangle base - 6px shaft width) / 2 = 2px offset + 5px */
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 20px solid var(--danger); /* Triangle pointing up */
        }

        .compass-needle::after { /* South tip (white) */
            content: '';
            position: absolute;
            top: 100%; /* Position right below the shaft */
            left: -7px; /* Adjust to center the triangle based on its width */
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 20px solid var(--text); /* Triangle pointing down */
        }
        /* --- FIN BRÚJULA --- */
        
        /* --- RELOJ ANALÓGICO (NUEVOS ESTILOS) --- */
        .clock-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        .analog-clock {
            width: 120px; /* Increased size */
            height: 120px; /* Increased size */
            border-radius: 50%;
            background: linear-gradient(145deg, rgba(var(--card-rgb), 0.8) 0%, rgba(var(--card-rgb), 0.5) 100%);
            border: 3px solid #cfd8e3; /* Adjusted for light theme */
            position: relative;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.2), 0 0 8px rgba(var(--blue-rgb), 0.1); /* Adjusted for light theme */
        }
        
        .analog-clock::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px; /* Increased size */
            height: 10px; /* Increased size */
            background-color: var(--blue);
            border-radius: 50%;
            z-index: 5;
            border: 1px solid rgba(var(--text-rgb), 0.2); /* Adjusted for light theme */
            box-shadow: 0 0 8px var(--blue);
        }

        .clock-number {
            position: absolute;
            font-size: 0.7rem; /* Adjusted font size */
            font-weight: 600; /* Adjusted for less thickness */
            color: var(--text);
            transform: translate(-50%, -50%);
            z-index: 1;
            text-shadow: 0 0 2px rgba(0,0,0,0.1); /* Subtle text shadow kept for legibility */
        }
        
        .clock-number:nth-child(1) { top: 5%; left: 50%; }
        .clock-number:nth-child(2) { top: 15%; left: 69%; }
        .clock-number:nth-child(3) { top: 25%; left: 85%; }
        .clock-number:nth-child(4) { top: 46%; left: 95%; }
        .clock-number:nth-child(5) { top: 69%; left: 85%; }
        .clock-number:nth-child(6) { top: 83%; left: 69%; }
        .clock-number:nth-child(7) { top: 90%; left: 49%; }
        .clock-number:nth-child(8) { top: 83%; left: 29%; }
        .clock-number:nth-child(9) { top: 69%; left: 13%; }
        .clock-number:nth-child(10) { top: 46%; left: 4%; }
        .clock-number:nth-child(11) { top: 25%; left: 13%; }
        .clock-number:nth-child(12) { top: 15%; left: 29%; }
        
        .hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom;
            transform: translateX(-50%) rotate(0deg);
            border-radius: 2px;
            z-index: 1;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .hour-hand {
            width: 5px; /* Increased size */
            height: 35px; /* Increased size */
            background-color: var(--text);
            z-index: 3;
        }

        .minute-hand {
            width: 4px; /* Increased size */
            height: 50px; /* Increased size */
            background-color: var(--blue);
            z-index: 2;
        }

        .second-hand-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120px; /* Increased size */
            height: auto;
            transform-origin: 50% 50%;
            transform: translate(-50%, -50%) rotate(0deg);
            z-index: 4;
            transition: transform 0.05s linear;
            filter: none; /* Removed glow for logo hand */
        }
        /* --- FIN RELOJ ANALÓGICO --- */

        /* --- FASE LUNAR DENTRO DE DATA-BOX --- */
        .moon-phase-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px 5px;
            min-height: 110px;
        }
        .moon-phase-box #moon-icon { /* This ID is now on the SVG element */
            width: 2.5em; /* Larger moon */
            height: 2.5em;
            animation: moonGlow 5s infinite ease-in-out alternate;
            filter: drop-shadow(0 0 15px rgba(var(--text-rgb), 0.8)); /* Stronger moon glow */
            margin: 0;
            line-height: 1;
            margin-bottom: 5px;
        }
        .moon-phase-box #moon-phase-text { /* New ID for the text span */
            font-weight: 600; /* Adjusted for less thickness */
            font-size: 1.1rem;
            color: var(--text);
            text-transform: uppercase;
            text-shadow: none; /* Removed glow from moon phase text */
        }
        /* --- FIN FASE LUNAR DENTRO DE DATA-BOX --- */

        /* --- TABLA DE MAREAS (Nuevo estilo para el enlace) --- */
        .tides-link-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%; /* Asegura que ocupe todo el espacio disponible */
            padding: 10px;
        }

        .tides-link {
            display: inline-block;
            background: var(--blue);
            color: #0d0d0d; /* Texto oscuro sobre azul vibrante */
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-family: var(--font-title);
            font-size: 1.1rem;
            font-weight: 600; /* Adjusted for less thickness */
            transition: all 0.2s ease;
            box-shadow: 0 4px 10px rgba(var(--blue-rgb), 0.4);
        }

        .tides-link:hover {
            background: var(--text);
            color: var(--blue);
            box-shadow: 0 6px 15px rgba(var(--blue-rgb), 0.6);
            transform: translateY(-2px);
        }

        /* --- GUIA PECES --- */
        .guide-container { padding: 15px; }
        .tabs { 
            display: flex; 
            margin-bottom: 15px; 
            border-bottom: 2px solid var(--border-line-color); 
            box-shadow: inset 0 -2px 5px var(--shadow-dark);
        }
        .tab { 
            flex: 1; padding: 15px; text-align: center; background: none; border: none; 
            color: var(--text-light);
            font-size: 1.2rem; cursor: pointer; font-family: var(--font-title); 
            transition: all 0.2s ease;
            text-shadow: none; /* No shadow on tabs */
            font-weight: 500; /* Adjusted for less thickness */
        }
        .tab.active { 
            color: var(--blue); 
            border-bottom: 3px solid var(--blue); 
            text-shadow: none; /* Removed glow from active tab text */
        }
        .tab:hover {
            color: var(--blue);
            text-shadow: none; /* Removed glow from hover tab text */
        }
        
        select { 
            width: 100%; padding: 15px; 
            background: var(--card); /* Adapted to theme variable */
            border: 1px solid var(--border-line-color); 
            color: var(--text); 
            border-radius: 8px; 
            font-size: 1.2rem;
            box-shadow: inset 0 1px 3px var(--shadow-inner);
        }

        .fish-details { 
            margin-top: 15px; display: none; padding: 15px; 
            background: var(--gradient-card);
            border-radius: 10px; 
            border: 1px solid rgba(var(--blue-rgb), 0.15);
            box-shadow: inset 0 0 5px var(--shadow-inner);
        }
        .fish-details.show { display: block; animation: fadeIn 0.3s; }
        .detail-item { margin-bottom: 15px; border-bottom: 1px solid var(--border-line-color); padding-bottom: 10px; }
        .detail-item:last-child { border: none; }

        /* --- TICKER ANIMATION (ESTRATEGIAS) --- */
        .ticker-wrap {
            width: 100%;
            overflow: hidden;
            background-color: var(--card);
            padding-top: 12px;
            padding-bottom: 12px;
            white-space: nowrap;
            box-sizing: border-box;
            border-top: 1px solid rgba(var(--blue-rgb), 0.1);
            border-bottom: 1px solid rgba(var(--blue-rgb), 0.1);
            margin-bottom: 12px;
            box-shadow: inset 0 1px 3px var(--shadow-inner), inset 0 -1px 3px var(--shadow-inner);
        }

        .ticker {
            display: inline-block;
            padding-left: 100%;
            animation: ticker-scroll 160s linear infinite;
            color: var(--yellow);
            font-family: var(--font-default); 
            font-size: 0.9rem; 
            font-weight: 400; /* Adjusted for less thickness */
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: none; /* Removed glow from ticker text */
        }

        @keyframes ticker-scroll {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }

        /* --- PREDICCION ESPECIES --- */
        .prediction-box { 
            background: rgba(var(--blue-rgb), 0.1);
            border: 1px solid var(--border-line-color); 
            text-align: left; 
            padding: 15px; 
            display: none; 
            box-shadow: 0 0 10px rgba(var(--blue-rgb), 0.15);
        }
        .species-list { 
            font-size: 1.1rem; 
            color: var(--text); 
            font-weight: 400; /* Adjusted for less thickness */
            margin-top: 8px; 
            line-height: 1.4; 
        }
        .biome-tag { 
            font-size: 0.9rem; 
            background: var(--blue); 
            color: #000; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-weight: 600; /* Adjusted for less thickness */
            box-shadow: 0 2px 5px var(--shadow-dark);
        }

        /* --- BOTONES --- */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px;}
        .btn-action {
            padding: 22px; border: none; border-radius: 12px; 
            color: white;
            display: flex; align-items: center; justify-content: center; gap: 10px; 
            font-size: 1.2rem; cursor: pointer; font-family: var(--font-title);
            box-shadow: 0 6px 0 var(--button-shadow-color), 0 0 15px rgba(var(--blue-rgb), 0.3);
            transition: all 0.15s ease;
            background: var(--gradient-button);
            text-shadow: none; /* Removed glow from button text */
            font-weight: 600; /* Adjusted for less thickness */
        }
        
        .btn-action:active { 
            transform: translateY(3px); 
            box-shadow: 0 3px 0 var(--button-shadow-color), 0 0 10px rgba(var(--blue-rgb), 0.2);
        }
        .btn-torch { 
            background: linear-gradient(145deg, var(--torch-bg-start) 0%, var(--torch-bg-end) 100%);
            box-shadow: 0 6px 0 var(--torch-shadow), 0 0 10px rgba(var(--text-light-rgb), 0.3);
            color: var(--text); /* Ensure text is readable in both themes */
            text-shadow: none; /* No text shadow unless active */
        }
        
        .btn-torch.on { 
            background: linear-gradient(145deg, #f1f5f9 0%, #e0e7ee 100%);
            color: #0b1120;
            box-shadow: 0 6px 0 #c2c9d0, 0 0 25px white;
            text-shadow: none; /* Removed glow from active torch button text */
        }
        
        .btn-log { 
            background: linear-gradient(145deg, var(--green) 0%, var(--log-button-shadow-color) 100%);
            box-shadow: 0 6px 0 var(--log-button-shadow-color), 0 0 15px rgba(var(--green-rgb), 0.3);
            color: #064e3b;
        }
        

        /* --- BITÁCORA --- */
        .log-container { margin-top: 30px; border-top: 2px solid var(--border-line-color); padding-top: 15px; }
        .log-item {
            background: var(--gradient-card);
            border-left: 5px solid var(--green);
            padding: 12px; margin-bottom: 10px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 2px 5px var(--shadow-dark);
        }
        .log-text { 
            font-size: 1rem; 
            color: var(--text); 
            font-weight: 600; /* Adjusted for less thickness */
        }
        .log-date { font-size: 0.85rem; color: var(--text-light); display: block; margin-top: 4px; }
        .btn-delete { 
            background: var(--log-delete-bg);
            border-radius: 6px; 
            color: var(--log-delete-color); 
            font-size: 1.3rem; 
            width: 40px; height: 40px; border: none; 
            box-shadow: inset 0 1px 3px var(--shadow-inner);
            transition: background-color 0.15s ease;
            animation: none; /* No pulse for interactive buttons */
        }
        
        .btn-delete .svg-icon {
            width: 1.3em;
            height: 1.3em;
            animation: none;
            filter: drop-shadow(0 0 8px rgba(var(--danger-rgb), 0.7));
        }

        .btn-delete:hover {
            background-color: var(--log-delete-bg-hover);
        }

        .btn-delete:hover .svg-icon {
            transform: scale(1.1);
            filter: drop-shadow(0 0 12px rgba(var(--danger-rgb), 1.0));
        }
        

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        @keyframes iconPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.02); }
        }

        @keyframes moonGlow {
            0% { transform: scale(1); filter: drop-shadow(0 0 15px rgba(var(--text-rgb), 0.8)); }
            100% { transform: scale(1.05); filter: drop-shadow(0 0 25px rgba(var(--text-rgb), 1.0)); }
        }

        @keyframes expandPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1.08); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
        }


        /* Scrollbar styling for a high-tech look */
        ::-webkit-scrollbar {
            width: 8px;
            background-color: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--card);
            border-radius: 4px;
            border: 1px solid var(--blue);
            box-shadow: 0 0 5px var(--blue);
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: var(--blue);
            box-shadow: 0 0 8px var(--blue);
        }

    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <!-- Overlay for expanded cards -->
    <div id="overlay" class="overlay"></div>

    <!-- SVG Icon Definitions (Sprite) -->
    <div style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg">
            <symbol id="icon-location" viewBox="0 0 24 24">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </symbol>
            <symbol id="icon-reload" viewBox="0 0 24 24">
                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
            </symbol>
            <symbol id="icon-thermometer" viewBox="0 0 24 24">
                <path d="M15 13V5c0-1.66-1.34-3-3-3S9 3.34 9 5v8c-1.21.91-2 2.35-2 4 0 2.76 2.24 5 5 5s5-2.24 5-5c0-1.65-.79-3.09-2-4zm-4-8c0-.55.45-1 1-1s1 .45 1 1v.79l-2-.01V5zm3.5 14c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
            </symbol>
            <symbol id="icon-tides" viewBox="0 0 24 24">
                <path d="M12 4c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm4.27 12.96c-.32.32-.84.32-1.16 0L12 14.83l-3.11 3.13c-.32.32-.84.32-1.16 0s-.32-.84 0-1.16L10.83 12 7.7 8.87c-.32-.32-.32-.84 0-1.16s.84-.32 1.16 0L12 9.17l3.11-3.13c.32-.32.84-.32 1.16 0s.32.84 0 1.16L13.17 12l3.13 3.11c.32.32.32.84 0 1.16z"/>
            </symbol>
            <symbol id="icon-pressure" viewBox="0 0 24 24">
                <path d="M16 11c-.55 0-1 .45-1 1v3H9v-3c0-.55-.45-1-1-1s-1 .45-1 1v4c0 .55.45 1 1 1h8c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1zM20 7H4c-.55 0-1 .45-1 1s.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1zM4 17h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1z"/>
            </symbol>
            <symbol id="icon-wind" viewBox="0 0 24 24">
                <path d="M12.43 2.05c-.06 0-.12.02-.17.06-.11.08-.15.22-.11.34l.8 2.4c-2.43 1.25-4.14 3.73-4.14 6.65 0 3.86 3.14 7 7 7 3.86 0 7-3.14 7-7 0-2.48-1.28-4.66-3.22-5.93l.8-2.4c.04-.12 0-.26-.11-.34-.1-.08-.24-.09-.34-.02l-4.22 2.2zM12 18c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/>
            </symbol>
            <symbol id="icon-moon" viewBox="0 0 24 24">
                <path d="M12 2.5c-4.42 0-8 3.58-8 8 0 4.42 3.58 8 8 8 1.48 0 2.87-.41 4.07-1.12C15.93 19.38 14.05 20 12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8c1.66 0 3.2.5 4.5 1.35C14.87 3.03 13.51 2.5 12 2.5zm0 15c-3.03 0-5.5-2.47-5.5-5.5S8.97 6.5 12 6.5c2.31 0 4.25 1.43 5.09 3.42C16.08 11.23 14.15 12 12 12c-3.03 0-5.5 2.47-5.5 5.5z"/>
            </symbol>
            <symbol id="icon-humidity" viewBox="0 0 24 24">
                <path d="M12 2c-3.87 0-7 3.13-7 7 0 3.87 7 13 7 13s7-9.13 7-13c0-3.87-3.13-7-7-7zm0 10.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </symbol>
            <symbol id="icon-clouds" viewBox="0 0 24 24">
                <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-2.82 0-5.32 1.45-6.84 3.69l-.17.22-1.42.23C2.86 8.35 1 10.03 1 12c0 2.21 1.79 4 4 4h14c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/>
            </symbol>
            <symbol id="icon-sunrise" viewBox="0 0 24 24">
                <path d="M13 14h-2V7h2v7zm8-6c0-1.66-1.34-3-3-3s-3 1.34-3 3h-2v1.5c0 .28-.22.5-.5.5s-.5-.22-.5-.5V8c0-2.21 1.79-4 4-4s4 1.79 4 4zm-4 10h-2v-4h2v4zM2 16h2v-4H2v4zM12 22c5.52 0 10-4.48 10-10h-2c0 4.41-3.59 8-8 8s-8-3.59-8-8H2c0 5.52 4.48 10 10 10z"/>
            </symbol>
            <symbol id="icon-sunset" viewBox="0 0 24 24">
                <path d="M12 18c5.52 0 10-4.48 10-10h-2c0 4.41-3.59 8-8 8s-8-3.59-8-8H2c0 5.52 4.48 10 10 10zm-1-8V2h2v6.18c-.41.38-1.04.82-2 1.4V10zm5-4c0 1.66-1.34 3-3 3s-3-1.34-3-3h-2c0 2.21 1.79 4 4 4s4-1.79 4-4h-2zM4 14h2v4H4zM18 14h2v4h-2z"/>
            </symbol>
            <symbol id="icon-torch" viewBox="0 0 24 24">
                <path d="M10 4c0-1.1-.9-2-2-2s-2 .9-2 2 .9 2 2 2 2-.9 2-2zm0 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM12 12c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm0 8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm0-16c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm-4 8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
                <path d="M10 2l-2 2 2 2 2-2-2-2zM10 22l-2-2 2-2 2 2-2 2zM12 10l-2 2 2 2 2-2-2-2zM12 18l-2-2 2-2 2 2-2 2zM12 2l-2-2 2-2 2 2-2 2zM12 22l-2 2 2 2 2-2-2-2zM10 12l-2-2 2-2 2 2-2 2zM10 20l-2-2 2-2 2 2-2 2zM10 4l-2 2 2 2 2-2-2-2z"/>
                <circle cx="8" cy="4" r="2"/>
                <circle cx="8" cy="20" r="2"/>
                <circle cx="12" cy="12" r="2"/>
                <circle cx="12" cy="20" r="2"/>
                <circle cx="12" cy="4" r="2"/>
                <circle cx="16" cy="12" r="2"/>
            </symbol>
            <symbol id="icon-log" viewBox="0 0 24 24">
                <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 16H5V5h14v14z"/>
                <path d="M7 15h10v2H7zM7 11h10v2H7zM7 7h10v2H7z"/>
            </symbol>
            <symbol id="icon-delete" viewBox="0 0 24 24">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </symbol>
        </svg>
    </div>

    <!-- 1. LOGO CON ENLACE -->
    <div class="brand-header">
        <a href="https://www.instagram.com/lolapalupulo/" target="_blank" class="brand-link">
            <img src="https://raw.githubusercontent.com/LOLAPALUPULO/LOLA-Pesca/refs/heads/main/lolapesca.svg" alt="Lola Pesca" class="brand-logo">
        </a>
    </div>

    <!-- 2. UBICACIÓN -->
    <div class="card-box location-bar">
        <div>
            <div class="loc-title" id="loc-name">
                <svg class="svg-icon" style="width: 1.4em; height: 1.4em; vertical-align: bottom;"><use xlink:href="#icon-location"></use></svg> Buscando GPS...
            </div>
            <div class="loc-sub" id="gps-status">Estableciendo conexión...</div>
        </div>
        <div class="location-controls">
            <button onclick="forceReload()" aria-label="Reload data">
                <svg class="svg-icon"><use xlink:href="#icon-reload"></use></svg>
            </button>
        </div>
    </div>

    <!-- REORGANIZACIÓN: Reloj / Brújula / Temperatura -->
    <div class="grid-main-3">
        <!-- Reloj Analógico -->
        <div class="data-box" id="analog-clock-box" onclick="toggleCardExpansion(this, event)">
            <div class="main-content">
                <span class="lbl">HORA ACTUAL</span>
                <div class="analog-clock" id="analog-clock">
                    <span class="clock-number">12</span>
                    <span class="clock-number">1</span>
                    <span class="clock-number">2</span>
                    <span class="clock-number">3</span>
                    <span class="clock-number">4</span>
                    <span class="clock-number">5</span>
                    <span class="clock-number">6</span>
                    <span class="clock-number">7</span>
                    <span class="clock-number">8</span>
                    <span class="clock-number">9</span>
                    <span class="clock-number">10</span>
                    <span class="clock-number">11</span>
                    <div class="hand hour-hand" id="hour-hand"></div>
                    <div class="hand minute-hand" id="minute-hand"></div>
                    <img src="https://raw.githubusercontent.com/LOLAPALUPULO/LOLA-Pesca/refs/heads/main/lolapesca.svg" alt="LOLA Pesca" class="second-hand-logo" id="second-hand-logo">
                </div>
            </div>
            <div class="expanded-detail" id="analog-clock-detail">
                <span class="lbl">HORA EXACTA</span>
                <div class="val" id="expanded-current-time">--:--:--</div>
                <div class="sub-val" id="expanded-current-date">--/--/----</div>
            </div>
        </div>
        <!-- TABLA DE MAREAS (Reemplaza a la brújula y muestra enlace) -->
        <div class="data-box" id="tides-box" onclick="toggleCardExpansion(this, event)">
            <div class="main-content">
                <span class="lbl lbl-with-icon"><svg class="svg-icon"><use xlink:href="#icon-tides"></use></svg> TABLA DE MAREAS</span>
                <div class="tides-link-container">
                    <a href="https://www.hidro.gov.ar/oceanografia/alturashorarias.asp" target="_blank" rel="noopener noreferrer" class="tides-link">
                        VER TABLA DE MAREAS
                    </a>
                </div>
            </div>
            <div class="expanded-detail" id="tides-detail">
                <svg class="svg-icon" style="color: var(--blue);"><use xlink:href="#icon-tides"></use></svg>
                <span class="lbl" style="margin-top: 15px;">MAREAS Y CORRIENTES</span>
                <p class="sub-val" style="margin-bottom: 15px; max-width: 80%; line-height: 1.4;">
                    Para información detallada y actualizada de mareas y corrientes, 
                    por favor visita el enlace a la fuente oficial.
                </p>
                <a href="https://www.hidro.gov.ar/oceanografia/alturashorarias.asp" target="_blank" rel="noopener noreferrer" class="tides-link">
                    IR A TABLA DE MAREAS
                </a>
            </div>
        </div>
        <!-- Temperatura (Movido) -->
        <div class="data-box" id="temp-box" onclick="toggleCardExpansion(this, event)">
            <div class="main-content">
                <span class="lbl lbl-with-icon" id="temp-icon-container"><svg class="svg-icon" id="temp-icon"><use xlink:href="#icon-thermometer"></use></svg> TEMP</span>
                <span class="val" id="temp">--°</span>
                <div class="sub-val" id="feels-like">ST: --°</div>
            </div>
            <div class="expanded-detail" id="temp-detail">
                <svg class="svg-icon" id="expanded-temp-icon"><use xlink:href="#icon-thermometer"></use></svg>
                <span class="lbl" style="margin-top: 15px;">TEMPERATURA AMBIENTE</span>
                <div class="val" id="expanded-temp-val">--°</div>
                <div class="sub-val" id="expanded-feels-like-val">ST: --°</div>
                <p class="sub-val" id="temp-comfort-desc" style="margin-top: 10px; max-width: 80%;">--</p>
            </div>
        </div>
    </div>

    <!-- REORGANIZACIÓN: Presión / Viento / Fase Lunar (Ex-Agua) -->
    <div class="grid-main-3">
        <!-- Presión HPA (Movido) -->
        <div class="data-box" id="pressure-box" onclick="toggleCardExpansion(this, event)">
            <div class="main-content">
                <span class="lbl lbl-with-icon"><svg class="svg-icon"><use xlink:href="#icon-pressure"></use></svg> PRESIÓN (hPa)</span>
                <span class="val" id="press">--</span>
                <span class="sub-val" id="press-desc" style="font-weight:600">Esperando..</span>
            </div>
            <div class="expanded-detail" id="pressure-detail">
                <svg class="svg-icon" style="color: var(--blue);"><use xlink:href="#icon-pressure"></use></svg>
                <span class="lbl" style="margin-top: 15px;">PRESIÓN BAROMÉTRICA</span>
                <div class="val" id="expanded-press-val">-- hPa</div>
                <div class="sub-val" id="expanded-press-desc">--</div>
                <p class="sub-val" id="pressure-trend-desc" style="margin-top: 10px; max-width: 80%;">--</p>
                <div class="sub-val" style="margin-top: 10px; font-size: 0.8rem;">Consulta el gráfico para el historial completo.</div>
            </div>
        </div>
        <!-- Viento (Movido) -->
        <div class="data-box" id="wind-box" onclick="toggleCardExpansion(this, event)">
            <div class="main-content">
                <span class="lbl lbl-with-icon"><svg class="svg-icon"><use xlink:href="#icon-wind"></use></svg> VIENTO</span>
                <span class="val" id="wind-speed">--</span>
                <div class="sub-val" id="wind-dir" style="color: var(--blue); font-weight:600;">--</div>
            </div>
            <div class="expanded-detail" id="wind-detail">
                <svg class="svg-icon" style="color: var(--blue);"><use xlink:href="#icon-wind"></use></svg>
                <span class="lbl" style="margin-top: 15px;">DETALLE DE VIENTO</span>
                <div class="val" id="expanded-wind-speed">-- km/h</div>
                <div class="sub-val" id="expanded-wind-dir" style="color: var(--blue);">--</div>
                <p class="sub-val" id="wind-intensity-desc" style="margin-top: 10px; max-width: 80%;">--</p>
            </div>
        </div>
        <!-- Fase Lunar (Movido al lugar de 'Agua') -->
        <div class="data-box moon-phase-box" id="moon-phase-box" onclick="toggleCardExpansion(this, event)">
            <div class="main-content">
                <span class="lbl">FASE LUNAR</span>
                <svg class="svg-icon" id="moon-icon"><use xlink:href="#icon-moon"></use></svg>
                <div id="moon-phase-text" style="font-weight:600">--</div>
            </div>
            <div class="expanded-detail" id="moon-detail">
                <svg class="svg-icon" id="expanded-moon-icon"><use xlink:href="#icon-moon"></use></svg>
                <span class="lbl" style="margin-top: 15px;">FASE LUNAR ACTUAL</span>
                <div class="val" id="expanded-moon-phase-text" style="font-weight:600">--</div>
                <div class="sub-val" id="expanded-moon-date">--/--/----</div>
                <p class="sub-val" style="margin-top: 10px; max-width: 80%;">
                    Las fases lunares influyen en las mareas y el comportamiento de algunas especies marinas.
                </p>
            </div>
        </div>
    </div>
    
    <!-- La antigua sección de Fase Lunar (card-box) ha sido eliminada. -->

    <!-- NUEVA SECCIÓN: CONDICIONES AMBIENTALES -->
    <div class="section-header">CONDICIONES AMBIENTALES</div>

    <div class="ambient-grid-parent">
        <!-- Humedad -->
        <div class="data-box ambient-data-box" id="humidity-box" onclick="toggleCardExpansion(this, event)">
            <div class="main-content">
                <span class="lbl lbl-with-icon"><svg class="svg-icon"><use xlink:href="#icon-humidity"></use></svg> HUMEDAD</span>
                <span class="val" id="humidity-val">--%</span>
                <span class="sub-val" style="font-weight:600"></span>
            </div>
            <div class="expanded-detail" id="humidity-detail">
                <svg class="svg-icon" style="color: var(--blue);"><use xlink:href="#icon-humidity"></use></svg>
                <span class="lbl" style="margin-top: 15px;">HUMEDAD RELATIVA</span>
                <div class="val" id="expanded-humidity-val">--%</div>
                <p class="sub-val" id="humidity-comfort-desc" style="margin-top: 10px; max-width: 80%;">--</p>
            </div>
        </div>
        <!-- Nubes -->
        <div class="data-box ambient-data-box" id="clouds-box" onclick="toggleCardExpansion(this, event)">
            <div class="main-content">
                <span class="lbl lbl-with-icon"><svg class="svg-icon"><use xlink:href="#icon-clouds"></use></svg> NUBES</span>
                <span class="val" id="clouds-val">--%</span>
                <span class="sub-val" style="font-weight:600"></span>
            </div>
            <div class="expanded-detail" id="clouds-detail">
                <svg class="svg-icon" style="color: var(--blue);"><use xlink:href="#icon-clouds"></use></svg>
                <span class="lbl" style="margin-top: 15px;">COBERTURA DE NUBES</span>
                <div class="val" id="expanded-clouds-val">--%</div>
                <p class="sub-val" id="clouds-cover-desc" style="margin-top: 10px; max-width: 80%;">--</p>
            </div>
        </div>
        <!-- Amanecer -->
        <div class="data-box ambient-data-box" id="sunrise-box" onclick="toggleCardExpansion(this, event)">
            <div class="main-content">
                <span class="lbl lbl-with-icon"><svg class="svg-icon"><use xlink:href="#icon-sunrise"></use></svg> AMANECER</span>
                <span class="val" id="sunrise-time">--:--</span>
                <span class="sub-val" style="font-weight:600"></span>
            </div>
            <div class="expanded-detail" id="sunrise-detail">
                <svg class="svg-icon" style="color: var(--blue);"><use xlink:href="#icon-sunrise"></use></svg>
                <span class="lbl" style="margin-top: 15px;">HORA DEL AMANECER</span>
                <div class="val" id="expanded-sunrise-time">--:--</div>
                <div class="sub-val" id="expanded-sunrise-date">--/--/----</div>
            </div>
        </div>
        <!-- Atardecer -->
        <div class="data-box ambient-data-box" id="sunset-box" onclick="toggleCardExpansion(this, event)">
            <div class="main-content">
                <span class="lbl lbl-with-icon"><svg class="svg-icon"><use xlink:href="#icon-sunset"></use></svg> ATARDECER</span>
                <span class="val" id="sunset-time">--:--</span>
                <span class="sub-val" style="font-weight:600"></span>
            </div>
            <div class="expanded-detail" id="sunset-detail">
                <svg class="svg-icon" style="color: var(--blue);"><use xlink:href="#icon-sunset"></use></svg>
                <span class="lbl" style="margin-top: 15px;">HORA DEL ATARDECER</span>
                <div class="val" id="expanded-sunset-time">--:--</div>
                <div class="sub-val" id="expanded-sunset-date">--/--/----</div>
            </div>
        </div>
    </div>

    <!-- NUEVA SECCIÓN: GRÁFICO DE PRESIÓN -->
    <div id="pressure-chart-container"></div>
    
    <!-- 6. CONSULTAS -->
    <div class="section-header">ENCICLOPEDIA TÁCTICA</div>

    <!-- TICKER (TEXTO PASANTE) DE ESTRATEGIAS -->
    <div class="ticker-wrap">
        <div class="ticker">
            ⚠️ SIGILO: Evita ruidos en la costa • 🌬️ VIENTO: Pesca donde golpea la ola, ahí está la comida • 🔪 AFILA: Revisa el filo del anzuelo siempre • 🦅 OBSERVA: Si hay gaviotas tirándose, hay cardumen • 🌑 LUNAS: Nueva y Llena mueven más agua • 📉 PRESIÓN: Si baja de golpe, el pique se corta • ⚙️ FRENO: Regula la estrella antes de tirar • 🪵 ESTRUCTURA: Busca palos y piedras, ahí acecha el predador •🩸 SANGRE: Cebo fresco es clave • 🧵 NYLON: Revisa los últimos metros, si está rasposo cortá • 🐟 DEVOLUCIÓN: Cuidá el recurso • 🌊 REPUNTE: El mejor momento es el cambio de marea • 🧼 LIMPIEZA: El pez huele el tabaco y combustible en tus manos.
        </div>
    </div>
    
    <div class="card-box prediction-box" id="bio-box">
        <span class="biome-tag" id="bio-region">ZONA...</span>
        <div class="lbl" style="margin-top:10px;">ESPECIES PREDOMINANTES:</div>
        <div class="species-list" id="bio-species">--</div>
    </div>

    <div class="card-box guide-container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('rio')">RÍO</button>
            <button class="tab" onclick="switchTab('mar')">MAR</button>
        </div>
        <select id="fish-selector" onchange="showFishInfo()">
            <!-- JS -->
        </select>
        <div id="fish-info" class="fish-details">
            <div class="detail-item">
                <div class="lbl">ANZUELO RECOMENDADO</div>
                <div id="fish-hook" style="font-size:1.2rem; color:var(--blue); font-weight:600;">--</div>
            </div>
            <div class="detail-item">
                <div class="lbl">MEJOR CARNADA</div>
                <div id="fish-bait" style="font-size:1.2rem;">--</div>
            </div>
            <div class="detail-item">
                <div class="lbl">INTELIGENCIA TÁCTICA</div>
                <div id="fish-tip" style="font-size:1.1rem; color:var(--orange); font-style:italic; line-height: 1.4;">--</div>
            </div>
        </div>
    </div>

    <!-- 7. HERRAMIENTAS -->
    <div class="action-grid">
        <button id="btn-torch" class="btn-action btn-torch" onclick="toggleFlash()">
            <svg class="svg-icon" style="width: 1.4em; height: 1.4em;"><use xlink:href="#icon-torch"></use></svg> LINTERNA
        </button>
        <button class="btn-action btn-log" onclick="saveQuickLog()">
            <svg class="svg-icon" style="width: 1.4em; height: 1.4em;"><use xlink:href="#icon-log"></use></svg> BITÁCORA
        </button>
    </div>

    <div id="log-history" class="log-container">
        <div style="text-align:center; color:#666; font-size:1rem; padding:10px;">Sin historial</div>
    </div>
    
    <!-- Punto de montaje para la lógica de React (oculto) -->
    <div id="react-root-dummy" style="display: none;"></div>

    <script>
        // --- CONFIG & DB AMPLIADA ---
        const fishDB = {
            rio: [
                {n:"Dorado", h:"5/0 a 8/0 Pata Larga", b:"Anguila, Morena, Sabalito", t:"Usa líder de acero 40lbs MINIMO. Busca correderas y palos sumergidos. El dorado caza por vibración y destello."},
                {n:"Surubí", h:"8/0 a 10/0 Ojal", b:"Morena grande, Anguila, Cascarudo", t:"Actividad nocturna. Busca veriles profundos y salidas de arroyos. Dejar comer antes de clavar."},
                {n:"Boga", h:"Simple chico (1 o 2) Pata Corta", b:"Maíz fermentado, Masa, Salamín, Corazón", t:"Boca muy dura pero pique sutil. Clava firme cuando corre la línea. Ceba la zona previamente."},
                {n:"Pejerrey (Río)", h:"Pequeño (4 o 5)", b:"Mojarra viva, Filet de dientudo", t:"Pesca a flote con boyas. Fundamental regular la profundidad (brazolada) según la temperatura."},
                {n:"Tararira", h:"Offset para goma / Triple", b:"Rana de goma, Dientudo fresco", t:"Se activa con calor. Busca zonas bajas con vegetación/juncos. Ataca por irritación o hambre."},
                {n:"Bagre (Moncholo/Amarillo)", h:"3/0 Común", b:"Lombriz de tierra, Tripa de pollo", t:"Pez de fondo. Busca remansos donde el agua gira lento. Ideal para principiantes o pesca variada."},
                {n:"Pacú", h:"Corto y fuerte (Mustad 92611)", b:"Bolitas de masa, Fruta (Aguai), Coquitos", t:"Pica muy suave, como si robara la carnada. Pescar bajo árboles o camalotes."},
                {n:"Patí", h:"8/0 a 10/0", b:"Anguila podrida, Tripa, Filet de Sábalo", t:"Prefiere aguas profundas y correntosas. Caza por olfato, usa carnada con olor fuerte."},
                {n:"Manguruyú", h:"12/0 Reforzado", b:"Anguila entera, boga viva chica", t:"El gigante del fondo. Equipo pesado exclusivo. Busca los pozos más profundos del cauce."}
            ],
            mar: [
                {n:"Corvina Rubia", h:"3/0 a 5/0", b:"Langostino, Anchoa, Almeja", t:"Lanza a la 2da canaleta. Come succionando el fondo. Si hay cangrejo, ata la carnada con hilo elástico."},
                {n:"Corvina Negra", h:"6/0 a 8/0 Reforzado", b:"Cangrejo vivo (colorado/negro)", t:"Busca fondos de piedra o barro en rías (San Clemente/Mar Chiquita). Paciencia extrema."},
                {n:"Lenguado", h:"Triple robador + Simple", b:"Pejerrey entero fresco", t:"Pesca dinámica (spinning/trolling). Recogida muy lenta arrastrando por el fondo de arena."},
                {n:"Pescadilla", h:"2/0 a 3/0", b:"Camarón, Filet de pejerrey", t:"Pica firme y voraz. Usa línea con destrabe o 'bait clip' para ganar distancia."},
                {n:"Pejerrey (Mar)", h:"Largo y fino (Cornalera)", b:"Camarón, Filet magru, Mondongo", t:"Línea de 3 boyas o paternoster. Busca la espuma de la ola (rompiente) o muelles."},
                {n:"Chucho / Raya", h:"6/0 a 8/0 Fuerte", b:"Anchoa entera, Calamar", t:"Se 'chupa' al fondo. No fuerces la caña, mantené tensión hasta que se mueva. Cuidado con la púa."},
                {n:"Burriqueta", h:"N3 o N4 Fino", b:"Lombriz de mar, Camarón", t:"Excelente pesca familiar. Se encuentra en la primer canaleta, muy cerca de la orilla."},
                {n:"Pez Elefante", h:"2/0 a 3/0", b:"Anchoa fresca, Lombriz de mar", t:"Pique sutil. Temporada invernal o primavera. Busca pozos de arena limpia."}
            ]
        };

        let currentMode = 'rio';
        let torchTrack = null;
        let dataRefreshInterval = null;
        let clockInterval = null;
        let expandedCardElement = null; // Track the currently expanded card

        window.appPressureHistory = [];
        const MAX_PRESSURE_HISTORY_POINTS = 20;

        // Store latest fetched data globally for expanded details
        window.latestWeatherData = {
            temperature_2m: null,
            apparent_temperature: null,
            pressure_msl: null,
            wind_speed_10m: null,
            wind_direction_10m: null,
            relative_humidity_2m: null,
            cloud_cover: null,
            sunrise: null,
            sunset: null
        };


        // --- STARTUP ---
        window.onload = () => {
            loadFishMenu();
            calculateMoonPhase();
            initApp(); 
            renderLog();
            updateClock();
            clockInterval = setInterval(updateClock, 1000);

            // Add event listener to overlay to close expanded card
            document.getElementById('overlay').addEventListener('click', () => {
                toggleCardExpansion(null, null); // Close any expanded card
            });
        };

        // --- CORE DATA LOGIC ---
        function forceReload() {
            document.getElementById('loc-name').innerHTML = `<svg class="svg-icon" style="width: 1.4em; height: 1.4em; vertical-align: bottom;"><use xlink:href="#icon-location"></use></svg> Reiniciando...`;
            if (dataRefreshInterval) clearInterval(dataRefreshInterval);
            initApp();
        }

        function initApp() {
            const fallbackLat = -34.6037;
            const fallbackLon = -58.3816;

            if(!navigator.geolocation) {
                alert("Navegador sin soporte GPS. Usando ubicación de respaldo.");
                fetchData(fallbackLat, fallbackLon, false);
                return;
            }

            const gpsOptions = { timeout: 8000, enableHighAccuracy: true };
            const safetyTimeout = setTimeout(() => {
                console.info("GPS tardó mucho. Usando ubicación de respaldo."); // Changed to info
                document.getElementById('gps-status').innerText = "Tiempo agotado. Modo Respaldo.";
                fetchData(fallbackLat, fallbackLon, false);
            }, 9000);

            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    clearTimeout(safetyTimeout);
                    fetchData(pos.coords.latitude, pos.coords.longitude, true);
                    if (dataRefreshInterval) clearInterval(dataRefreshInterval);
                    dataRefreshInterval = setInterval(() => {
                        fetchData(pos.coords.latitude, pos.coords.longitude, true);
                    }, 300000);
                }, 
                (err) => {
                    clearTimeout(safetyTimeout);
                    let statusMessage = "GPS FALLO. Intentando modo DEMO.";
                    if (err.code === err.PERMISSION_DENIED) {
                        statusMessage = "GPS DENEGADO. Active en configuración.";
                        console.info(`GPS Falló: Permiso denegado por el usuario. Usando ubicación de respaldo. Detalle: ${err.message}`); // Changed to info
                    } else {
                        console.info(`GPS Falló: Error de adquisición (${err.message}). Usando ubicación de respaldo.`); // Changed to info
                    }
                    document.getElementById('gps-status').innerText = `🔴 ${statusMessage}`;
                    document.getElementById('gps-status').style.color = "var(--danger)";
                    document.getElementById('temp').innerText = "--°";
                    document.getElementById('feels-like').innerText = "ST: --°";
                    document.getElementById('wind-speed').innerText = "--";
                    document.getElementById('wind-dir').innerText = "--";
                    document.getElementById('press').innerText = "--";
                    document.getElementById('press-desc').innerText = "Sin Datos";
                    document.getElementById('humidity-val').innerText = '--%';
                    document.getElementById('clouds-val').innerText = '--%';
                    document.getElementById('sunrise-time').innerText = '--:--';
                    document.getElementById('sunset-time').innerText = '--:--';
                    fetchData(fallbackLat, fallbackLon, false);
                    if (dataRefreshInterval) clearInterval(dataRefreshInterval);
                    dataRefreshInterval = setInterval(() => {
                        fetchData(fallbackLat, fallbackLon, false);
                    }, 300000);
                }, 
                gpsOptions
            );
        }

        function fetchData(lat, lon, isReal) {
            document.getElementById('gps-status').innerText = isReal ? "🟢 GPS ACTIVO" : "🔴 MODO DEMO (SIN GPS)";
            document.getElementById('gps-status').style.color = isReal ? "var(--green)" : "var(--danger)";

            if(isReal) {
                fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                .then(r=>r.json())
                .then(d => {
                    document.getElementById('loc-name').innerHTML = `<svg class="svg-icon" style="width: 1.4em; height: 1.4em; vertical-align: bottom;"><use xlink:href="#icon-location"></use></svg> ` + (d.address.city || d.address.town || d.address.village || "Zona Detectada");
                }).catch((e)=> {
                    console.error("Error al obtener nombre de ubicación:", e);
                    document.getElementById('loc-name').innerHTML = `<svg class="svg-icon" style="width: 1.4em; height: 1.4em; vertical-align: bottom;"><use xlink:href="#icon-location"></use></svg> Zona de Pesca (Nombre no disponible)`;
                });
            } else {
                document.getElementById('loc-name').innerHTML = `<svg class="svg-icon" style="width: 1.4em; height: 1.4em; vertical-align: bottom;"><use xlink:href="#icon-location"></use></svg> Buenos Aires (Defecto)`;
            }

            determineSpecies(lat, lon);

            const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,pressure_msl,surface_pressure,wind_speed_10m,wind_direction_10m,relative_humidity_2m,cloud_cover&daily=sunrise,sunset&timezone=auto&windspeed_unit=kmh`;

            fetch(weatherUrl)
                .then(r => {
                    if (!r.ok) {
                        throw new Error(`HTTP error! status: ${r.status}`);
                    }
                    return r.json();
                })
                .then(data => {
                console.log("Open-Meteo API Response (Clima/Ambiente):", data);

                const cur = data.current || {};
                const daily = data.daily || {};

                // Update global weather data
                window.latestWeatherData = {
                    temperature_2m: cur?.temperature_2m,
                    apparent_temperature: cur?.apparent_temperature,
                    pressure_msl: cur?.pressure_msl,
                    wind_speed_10m: cur?.wind_speed_10m,
                    wind_direction_10m: cur?.wind_direction_10m,
                    relative_humidity_2m: cur?.relative_humidity_2m,
                    cloud_cover: cur?.cloud_cover,
                    sunrise: daily?.sunrise?.[0],
                    sunset: daily?.sunset?.[0]
                };

                // Temp
                const currentTemp = cur?.temperature_2m;
                const tempElement = document.getElementById('temp');
                const feelsLikeElement = document.getElementById('feels-like');
                const tempIconContainer = document.getElementById('temp-icon-container'); // Get the container

                if (currentTemp !== undefined && currentTemp !== null) {
                    tempElement.innerText = `${Math.round(currentTemp)}°`;
                    if (tempIconContainer) { // Apply color to the container, SVG inherits
                        if (currentTemp < 10) {
                            tempIconContainer.style.color = "var(--blue)";
                        } else if (currentTemp > 25) {
                            tempIconContainer.style.color = "var(--danger)";
                        } else {
                            tempIconContainer.style.color = "var(--yellow)";
                        }
                    }
                } else {
                    tempElement.innerText = "--°";
                    if (tempIconContainer) {
                        tempIconContainer.style.color = "var(--text-light)"; // Default neutral color
                    }
                }
                
                feelsLikeElement.innerText = cur?.apparent_temperature !== undefined && cur?.apparent_temperature !== null ? `ST: ${Math.round(cur.apparent_temperature)}°` : 'ST: --°';

                // Viento
                document.getElementById('wind-speed').innerText = cur?.wind_speed_10m !== undefined && cur?.wind_speed_10m !== null ? `${Math.round(cur.wind_speed_10m)} km/h` : '--';
                let wDir = cur?.wind_direction_10m; 
                if (wDir !== undefined && wDir !== null) {
                    const dirs = ['NORTE', 'NE', 'ESTE', 'SE', 'SUR', 'SO', 'OESTE', 'NO'];
                    const dirIndex = Math.round(((wDir %= 360) < 0 ? wDir + 360 : wDir) / 45) % 8;
                    document.getElementById('wind-dir').innerText = "DEL " + dirs[dirIndex];
                } else {
                    document.getElementById('wind-dir').innerText = '--';
                }

                // Presión HPA
                const pressureHPA = cur?.pressure_msl;
                const pressElement = document.getElementById('press');
                const pDescElement = document.getElementById('press-desc');

                if (pressElement && pDescElement && pressureHPA !== undefined && pressureHPA !== null) {
                    pressElement.innerText = Math.round(pressureHPA).toString();
                    let descText; 
                    let descColor; 
                    if (pressureHPA <= 1009) {
                        descText = "BAJA";
                        descColor = "var(--danger)";
                    } else if (pressureHPA >= 1016) {
                        descText = "ALTA";
                        descColor = "var(--green)";
                    } else {
                        descText = "ESTABLE";
                        descColor = "var(--text-light)";
                    }
                    pDescElement.innerText = descText;
                    pDescElement.style.color = descColor;

                    window.appPressureHistory.push({
                        time: new Date().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' }),
                        hpa: Math.round(pressureHPA)
                    });
                    if (window.appPressureHistory.length > MAX_PRESSURE_HISTORY_POINTS) {
                        window.appPressureHistory.shift();
                    }
                    window.dispatchEvent(new CustomEvent('newPressureData'));

                } else {
                    if (pressElement) pressElement.innerText = "--";
                    if (pDescElement) pDescElement.innerText = "Sin Datos";
                }

                // Humedad
                const humidityVal = cur?.relative_humidity_2m;
                document.getElementById('humidity-val').innerText = (humidityVal !== undefined && humidityVal !== null) ? `${Math.round(humidityVal)}%` : '--%';
                if (humidityVal === undefined || humidityVal === null) console.warn("Humedad no disponible o es null en la respuesta de la API.");

                // Nubes
                const cloudsVal = cur?.cloud_cover;
                document.getElementById('clouds-val').innerText = (cloudsVal !== undefined && cloudsVal !== null) ? `${Math.round(cloudsVal)}%` : '--%';
                if (cloudsVal === undefined || cloudsVal === null) console.warn("Cobertura de nubes no disponible o es null en la respuesta de la API.");

                // Amanecer y Atardecer
                if (daily?.sunrise?.[0] && daily?.sunset?.[0]) {
                    const sunriseTime = new Date(daily.sunrise[0]).toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
                    const sunsetTime = new Date(daily.sunset[0]).toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
                    document.getElementById('sunrise-time').innerText = sunriseTime;
                    document.getElementById('sunset-time').innerText = sunsetTime;
                } else {
                    document.getElementById('sunrise-time').innerText = '--:--';
                    document.getElementById('sunset-time').innerText = '--:--';
                    console.warn("Datos de amanecer/atardecer no disponibles o están vacíos en la respuesta de la API.");
                }

                console.log("UI actualizada para humedad, nubes, amanecer, atardecer.");

            }).catch(e => {
                console.error("API Error (Clima/Ambiente):", e);
                document.getElementById('temp').innerText = "--°";
                document.getElementById('feels-like').innerText = "ST: --°";
                document.getElementById('wind-speed').innerText = "--";
                document.getElementById('wind-dir').innerText = "--";
                document.getElementById('press').innerText = "--";
                document.getElementById('press-desc').innerText = "Sin Datos";
                document.getElementById('humidity-val').innerText = '--%';
                document.getElementById('clouds-val').innerText = '--%';
                document.getElementById('sunrise-time').innerText = '--:--';
                document.getElementById('sunset-time').innerText = '--:--';
                
                const tempIconContainer = document.getElementById('temp-icon-container');
                if (tempIconContainer) {
                    tempIconContainer.style.color = "var(--text-light)";
                }
            });
        }

        // --- CÁLCULO LUNAR ---
        function calculateMoonPhase() {
            const date = new Date();
            const lp = 2551443; 
            const new_moon = new Date(1970, 0, 7, 20, 35, 0);
            const phase_total = ((date.getTime() - new_moon.getTime()) / 1000) % lp;
            const phase_days = Math.floor(phase_total / (24 * 3600)) + 1;
            
            let phase = "Nueva";
            if (phase_days >= 2 && phase_days < 8) { phase = "Creciente"; }
            else if (phase_days >= 8 && phase_days < 10) { phase = "Cuarto Crec."; }
            else if (phase_days >= 10 && phase_days < 14) { phase = "Gibosa"; }
            else if (phase_days >= 14 && phase_days < 16) { phase = "LLENA"; }
            else if (phase_days >= 16 && phase_days < 22) { phase = "Menguante"; }
            else if (phase_days >= 22 && phase_days < 24) { phase = "Cuarto Meng."; }
            else if (phase_days >= 24) { phase = "Menguante"; }
            
            const moonPhaseTextElement = document.getElementById('moon-phase-text');
            const expandedMoonPhaseTextElement = document.getElementById('expanded-moon-phase-text');

            if (moonPhaseTextElement) {
                moonPhaseTextElement.innerText = phase.toUpperCase();
            }
            if (expandedMoonPhaseTextElement) {
                expandedMoonPhaseTextElement.innerText = phase.toUpperCase();
            }

            const expandedMoonDateElement = document.getElementById('expanded-moon-date');
            if (expandedMoonDateElement) {
                expandedMoonDateElement.innerText = date.toLocaleDateString('es-AR');
            }

            if (!moonPhaseTextElement) {
                console.warn("Elemento de texto de fase lunar no encontrado para actualizar. Asegúrate de que el ID 'moon-phase-text' exista en el DOM.");
            }
        }

        function determineSpecies(lat, lon) {
            const box = document.getElementById('bio-box');
            const regionLbl = document.getElementById('bio-region');
            const speciesLbl = document.getElementById('bio-species');
            box.style.display = 'block';
            
            if (lat > -35 && lat < -33 && lon > -60 && lon < -57) {
                regionLbl.innerText = "DELTA / RÍO DE LA PLATA";
                speciesLbl.innerText = "Dorado, Boga, Tararira, Bagre, Surubí.";
            } else if (lat <= -36 && lat > -42 && lon > -60) {
                regionLbl.innerText = "COSTA ATLÁNTICA";
                speciesLbl.innerText = "Corvina, Pescadilla, Lenguado, Pejerrey.";
            } else if (lat > -33 && lat < -25 && lon > -60) {
                regionLbl.innerText = "LITORAL / PARANÁ";
                speciesLbl.innerText = "Dorado, Surubí, Pacú, Manguruyú.";
            } else {
                regionLbl.innerText = "ZONA GENERAL";
                speciesLbl.innerText = "Variada local. Verifique reglamentación.";
            }
        }

        // --- TABLA DE MAREAS (Funciones eliminadas, ahora solo enlace) ---
        // function fetchTidesData(lat, lon) { /* ... */ }

        // --- RELOJ ANALÓGICO ---
        function updateClock() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();

            const secondHandLogo = document.getElementById('second-hand-logo');
            const minuteHand = document.getElementById('minute-hand');
            const hourHand = document.getElementById('hour-hand');

            if (secondHandLogo && minuteHand && hourHand) {
                const secondsDegrees = (seconds / 60) * 360;
                const minutesDegrees = ((minutes + seconds / 60) / 60) * 360;
                const hoursDegrees = ((hours % 12 + minutes / 60) / 12) * 360;

                secondHandLogo.style.transform = `translate(-50%, -50%) rotate(${secondsDegrees}deg)`;
                minuteHand.style.transform = `translateX(-50%) rotate(${minutesDegrees}deg)`;
                hourHand.style.transform = `translateX(-50%) rotate(${hoursDegrees}deg)`;
            }

            // Update expanded clock details if visible
            const expandedCurrentTime = document.getElementById('expanded-current-time');
            const expandedCurrentDate = document.getElementById('expanded-current-date');
            if (expandedCurrentTime) {
                expandedCurrentTime.innerText = now.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            }
            if (expandedCurrentDate) {
                expandedCurrentDate.innerText = now.toLocaleDateString('es-AR');
            }
        }

        // --- CARD EXPANSION LOGIC ---
        function toggleCardExpansion(clickedElement, event) {
            const overlay = document.getElementById('overlay');
            const body = document.body;

            // Prevent clicks on links within the card from triggering expansion/contraction
            if (event && event.target && event.target.tagName === 'A') {
                return; 
            }

            if (expandedCardElement) {
                // If a card is already expanded, close it
                expandedCardElement.classList.remove('expanded');
                overlay.classList.remove('active');
                body.classList.remove('no-scroll');
                
                // If the clicked element was the one currently expanded, we're done.
                if (expandedCardElement === clickedElement) {
                    expandedCardElement = null;
                    return;
                }
                expandedCardElement = null; // Reset after closing
            }

            // If a new element was clicked (and no card was expanded OR a different one was expanded)
            if (clickedElement && !clickedElement.classList.contains('expanded')) {
                clickedElement.classList.add('expanded');
                overlay.classList.add('active');
                body.classList.add('no-scroll');
                expandedCardElement = clickedElement;
                updateExpandedDetail(clickedElement.id); // Populate details when expanded
            }
        }

        // Function to update the content of the expanded detail
        function updateExpandedDetail(cardId) {
            const data = window.latestWeatherData;
            const now = new Date();

            switch (cardId) {
                case 'analog-clock-box':
                    document.getElementById('expanded-current-time').innerText = now.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    document.getElementById('expanded-current-date').innerText = now.toLocaleDateString('es-AR');
                    break;
                case 'temp-box':
                    const currentTemp = data.temperature_2m;
                    const apparentTemp = data.apparent_temperature;
                    document.getElementById('expanded-temp-val').innerText = currentTemp !== null ? `${Math.round(currentTemp)}°` : '--°';
                    document.getElementById('expanded-feels-like-val').innerText = apparentTemp !== null ? `ST: ${Math.round(apparentTemp)}°` : 'ST: --°';
                    let comfortDesc = '--';
                    if (currentTemp !== null) {
                        if (currentTemp < 5) comfortDesc = 'Sensación de FRÍO intenso. Abrígate bien.';
                        else if (currentTemp >= 5 && currentTemp < 15) comfortDesc = 'Clima FRESCO. Se recomienda una capa extra.';
                        else if (currentTemp >= 15 && currentTemp < 25) comfortDesc = 'Temperatura AGRADABLE. Ideal para actividades.';
                        else if (currentTemp >= 25 && currentTemp < 30) comfortDesc = 'Clima CÁLIDO. Mantente hidratado.';
                        else if (currentTemp >= 30) comfortDesc = 'Sensación de CALOR extremo. Evita la exposición prolongada.';
                    }
                    document.getElementById('temp-comfort-desc').innerText = comfortDesc;
                    document.getElementById('expanded-temp-icon').style.color = document.getElementById('temp-icon-container').style.color; // Keep dynamic color
                    break;
                case 'pressure-box':
                    const pressureHPA = data.pressure_msl;
                    document.getElementById('expanded-press-val').innerText = pressureHPA !== null ? `${Math.round(pressureHPA)} hPa` : '-- hPa';
                    
                    let expandedPressDesc = '--';
                    let pressureTrend = '--';
                    if (pressureHPA !== null) {
                        if (pressureHPA <= 1009) expandedPressDesc = "BAJA";
                        else if (pressureHPA >= 1016) expandedPressDesc = "ALTA";
                        else expandedPressDesc = "ESTABLE";

                        if (window.appPressureHistory.length >= 3) {
                            const lastThree = window.appPressureHistory.slice(-3);
                            const avgFirstTwo = (lastThree[0].hpa + lastThree[1].hpa) / 2;
                            const current = lastThree[2].hpa;
                            if (current > avgFirstTwo + 0.5) pressureTrend = "Presión SUBIENDO.";
                            else if (current < avgFirstTwo - 0.5) pressureTrend = "Presión BAJANDO.";
                            else pressureTrend = "Presión ESTABLE.";
                        }
                    }
                    document.getElementById('expanded-press-desc').innerText = expandedPressDesc;
                    document.getElementById('pressure-trend-desc').innerText = pressureTrend;
                    break;
                case 'wind-box':
                    const windSpeed = data.wind_speed_10m;
                    let windDirection = data.wind_direction_10m;
                    document.getElementById('expanded-wind-speed').innerText = windSpeed !== null ? `${Math.round(windSpeed)} km/h` : '-- km/h';

                    let expandedWindDir = '--';
                    let windIntensityDesc = '--';
                    if (windDirection !== null) {
                        const dirs = ['NORTE', 'NE', 'ESTE', 'SE', 'SUR', 'SO', 'OESTE', 'NO'];
                        const dirIndex = Math.round(((windDirection %= 360) < 0 ? windDirection + 360 : windDirection) / 45) % 8;
                        expandedWindDir = `DEL ${dirs[dirIndex]}`;
                    }
                    document.getElementById('expanded-wind-dir').innerText = expandedWindDir;

                    if (windSpeed !== null) {
                        if (windSpeed < 5) windIntensityDesc = 'Calma o Brisa muy ligera. Condiciones ideales.';
                        else if (windSpeed >= 5 && windSpeed < 20) windIntensityDesc = 'Brisa moderada. Puede influir en la línea.';
                        else if (windSpeed >= 20 && windSpeed < 40) windIntensityDesc = 'Viento moderado a fuerte. Considerar resguardo.';
                        else if (windSpeed >= 40) windIntensityDesc = 'Viento muy fuerte. Precaución extrema.';
                    }
                    document.getElementById('wind-intensity-desc').innerText = windIntensityDesc;
                    break;
                case 'moon-phase-box':
                    document.getElementById('expanded-moon-phase-text').innerText = document.getElementById('moon-phase-text').innerText;
                    document.getElementById('expanded-moon-date').innerText = now.toLocaleDateString('es-AR');
                    break;
                case 'humidity-box':
                    const humidityVal = data.relative_humidity_2m;
                    document.getElementById('expanded-humidity-val').innerText = humidityVal !== null ? `${Math.round(humidityVal)}%` : '--%';
                    let humidityComfort = '--';
                    if (humidityVal !== null) {
                        if (humidityVal < 40) humidityComfort = 'Ambiente seco. Poca humedad en el aire.';
                        else if (humidityVal >= 40 && humidityVal < 60) humidityComfort = 'Humedad confortable. Condiciones agradables.';
                        else if (humidityVal >= 60 && humidityVal < 80) humidityComfort = 'Ambiente húmedo. Sensación pegajosa.';
                        else if (humidityVal >= 80) humidityComfort = 'Muy húmedo. Posible neblina o rocío.';
                    }
                    document.getElementById('humidity-comfort-desc').innerText = humidityComfort;
                    break;
                case 'clouds-box':
                    const cloudsVal = data.cloud_cover;
                    document.getElementById('expanded-clouds-val').innerText = cloudsVal !== null ? `${Math.round(cloudsVal)}%` : '--%';
                    let cloudsDesc = '--';
                    if (cloudsVal !== null) {
                        if (cloudsVal < 10) cloudsDesc = 'Cielo DESPEJADO. Poca o ninguna nube.';
                        else if (cloudsVal >= 10 && cloudsVal < 40) cloudsDesc = 'PARCIALMENTE nublado. Algunas nubes dispersas.';
                        else if (cloudsVal >= 40 && cloudsVal < 80) cloudsDesc = 'NUBLADO. Mayormente cubierto de nubes.';
                        else if (cloudsVal >= 80) cloudsDesc = 'Cielo CUBIERTO. Ideal para peces de sombra.';
                    }
                    document.getElementById('clouds-cover-desc').innerText = cloudsDesc;
                    break;
                case 'sunrise-box':
                    const sunriseDate = data.sunrise ? new Date(data.sunrise) : null;
                    document.getElementById('expanded-sunrise-time').innerText = sunriseDate ? sunriseDate.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' }) : '--:--';
                    document.getElementById('expanded-sunrise-date').innerText = sunriseDate ? sunriseDate.toLocaleDateString('es-AR') : '--/--/----';
                    break;
                case 'sunset-box':
                    const sunsetDate = data.sunset ? new Date(data.sunset) : null;
                    document.getElementById('expanded-sunset-time').innerText = sunsetDate ? sunsetDate.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' }) : '--:--';
                    document.getElementById('expanded-sunset-date').innerText = sunsetDate ? sunsetDate.toLocaleDateString('es-AR') : '--/--/----';
                    break;
            }
        }


        // --- UI ---
        function switchTab(m){ currentMode=m; document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); event.target.classList.add('active'); loadFishMenu(); }
        function loadFishMenu(){ const s=document.getElementById('fish-selector'); s.innerHTML='<option>Selecciona pez...</option>'; fishDB[currentMode].forEach((f,i)=>{const o=document.createElement('option'); o.value=i; o.innerText=f.n; s.appendChild(o)}); document.getElementById('fish-info').classList.remove('show'); }
        function showFishInfo(){ const i=document.getElementById('fish-selector').value; if(!i)return; const f=fishDB[currentMode][i]; document.getElementById('fish-hook').innerText=f.h; document.getElementById('fish-bait').innerText=f.b; document.getElementById('fish-tip').innerText=f.t; document.getElementById('fish-info').classList.add('show'); }
        
        async function toggleFlash(){ 
            const b=document.getElementById('btn-torch'); 
            if(torchTrack){torchTrack.stop(); torchTrack=null; b.classList.remove('on'); return;} 
            try{ 
                const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}); 
                torchTrack=s.getVideoTracks()[0]; 
                await torchTrack.applyConstraints({advanced:[{torch:true}]}); 
                b.classList.add('on'); 
            }catch(e){alert("Error: Flash requiere permiso de cámara/HTTPS.");} 
        }

        // --- LOCALSTORAGE ---
        function saveQuickLog() {
            const text = prompt("📝 Captura (Especie - Kg):");
            if(text) {
                const now = new Date();
                const dStr = now.getDate() + "/" + (now.getMonth()+1) + " " + now.getHours() + ":" + (now.getMinutes()<10?'0':'')+now.getMinutes();
                const item = { id: Date.now(), text: text, date: dStr };
                let h = JSON.parse(localStorage.getItem('pescaLog')) || [];
                h.unshift(item);
                localStorage.setItem('pescaLog', JSON.stringify(h));
                renderLog();
            }
        }
        function renderLog() {
            const c = document.getElementById('log-history');
            const h = JSON.parse(localStorage.getItem('pescaLog')) || [];
            if (h.length === 0) { c.innerHTML = '<div style="text-align:center; color:#666; font-size:1rem; padding:10px;">Sin historial</div>'; return; }
            let html = "";
            h.forEach(i => {
                html += `<div class="log-item"><div><span class="log-text">${i.text}</span><span class="log-date">${i.date}</span></div><button class="btn-delete" onclick="deleteLog(${i.id})"><svg class="svg-icon"><use xlink:href="#icon-delete"></use></svg></button></div>`;
            });
            c.innerHTML = html;
        }
        function deleteLog(id) {
            if(confirm("¿Borrar?")) {
                let h = JSON.parse(localStorage.getItem('pescaLog')) || [];
                h = h.filter(i => i.id !== id);
                localStorage.setItem('pescaLog', JSON.stringify(h));
                renderLog();
            }
        }
    </script>
    <script type="module" src="/index.tsx"></script>
</body>
</html>